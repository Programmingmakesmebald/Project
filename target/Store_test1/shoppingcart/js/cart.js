var firstShipping,categoryid,shippingData;firstShipping=0;categoryid=2;shippingData=null;shippingProducts="";(function(){var a,c,d,b=[].indexOf||function(g){for(var f=0,e=this.length;f<e;f++){if(f in this&&this[f]===g){return f}}return -1};if(!window.console){window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}}a=(function(){e.prototype.ignoreList=[];function e(f){var h,g;if(f==null){f={}}this.config={uid:"0",container:$(".shopping-ads"),title:"",provider:void 0,frame:void 0,id:void 0,request_id:void 0,length:void 0};$.extend(true,this.config,f);if(this.config.uid!=="0"&&(g=this.config.uid,b.call(this.ignoreList,g)>=0)){var i=this.config.id;$("#"+i).show();return}this.ignoreList.push(this.config.uid);this.config.id=f.id;if(this.config.id=="fn-my-wish"){this.config._$=$("<div class='ads_tab'><a href='http://myhome.dangdang.com/myFavorite' target='_blank'>"+this.config.title+"</a></div><div class='ads_box'><a href='javascript:;' class='arrow left'></a><a href='javascript:;' class='arrow right'></a><ul class='ads_num'></ul><div class='show_list'></div></div>")}else{if(this.config.id.indexOf("similar")>=0){if(this.config.length<5){this.config._$=$("<div class='ads_box'><a href='javascript:;' class='close fn-close-similar'>关闭</a><ul class='ads_num'></ul><div class='show_list'></div></div>")}else{this.config._$=$("<div class='ads_box'><a href='javascript:;' class='close fn-close-similar'>关闭</a><a href='javascript:;' class='arrow left'></a><a href='javascript:;' class='arrow right'></a><ul class='ads_num'></ul><div class='show_list'></div></div>")}}else{if((this.config.length<16&&this.config.id=="fn-weinituijian")||((this.config.id=="J_weinituijian"||this.config.id=="J_alsobuy")&&this.config.length<20)||this.config.length<6){this.config._$=$("<div class='ads_tab'>"+this.config.title+"</div><div class='ads_box'><ul class='ads_num'></ul><div class='show_list'></div></div>")}else{this.config._$=$("<div class='ads_tab'>"+this.config.title+"</div><div class='ads_box'><a href='javascript:;' class='arrow left'></a><a href='javascript:;' class='arrow right'></a><ul class='ads_num'></ul><div class='show_list'></div></div>")}}}if(this.config.content){this.config._$.find(".ads_box").html(this.config.content)}$("#"+this.config.id).html(this.config._$);$("#"+this.config.id).show();if(typeof(h=this.config).provider==="function"){h.provider(this)}}e.prototype.render=function(h){var f,y,x,I,H,k,p,q,v,C,F,D,B,G,z,E,A,w,n,r,u,g,o,t,s,J;C=this;v=C.config._$;if(!v){return}G=h.length;if(G===0){v.hide();return}I=5;if(C.config.id==="J_alsobuy"||C.config.id==="fn-weinituijian"||C.config.id==="J_weinituijian"){I=10}if(C.config.id.indexOf("similar")>=0){I=4}J=Math.ceil(G/I);if(C.config.id==="fn-weinituijian"&&(G%10>0)&&(G%10<6)){J=J-1}H=$("#"+C.config.id).data({index:0,max:J-1});q=v.find(".ads_num");if(J>1){for(F=1;F<=J;F++){if(F==1){p=$("<li class='pageTab'>").addClass("on").html(F)}else{p=$("<li class='pageTab'>").html(F)}p.appendTo(q)}}q.append(p);k=v.find(".show_list");if(C.config.id==="J_alsobuy"||C.config.id==="fn-weinituijian"||C.config.id==="J_weinituijian"){x=$("<div>").addClass("big_box");k.append(x)}for(F=B=0,o=J;0<=o?B<o:B>o;F=0<=o?++B:--B){q=$("<ul>").addClass("show_box");if(C.config.id==="J_alsobuy"||C.config.id==="J_weinituijian"||C.config.id==="fn-weinituijian"){q=$("<ul>").addClass("show_box line2");q.attr("request_id",C.config.request_id)}else{if(C.config.id.indexOf("similar")>=0){q.attr("request_id",C.config.request_id);q=$("<ul>").addClass("show_box")}else{q=$("<ul>").addClass("show_box")}}if(F!==0){q.hide()}A=F*I;E=A+I;E=E>G?G:E;for(D=z=t=A,s=E;t<=s?z<s:z>s;D=t<=s?++z:--z){g=h[D]||{};if(g.pid){u=g.pid-0;if(g.mainProductId&&!g.numImages){n=cart.getProductImgUrlWithVersion(g.mainProductId,u,g.numImages,g.imgVersion,"b")}else{n=cart.getProductImgUrlWithVersion(0,u,0,g.imgVersion,"b")}r=cart.getProductUrl(u);w="";if(g.isMonitor){if(C.config.id==="J_alsobuy"){f=r+"#ddclick_reco_shoppingcart_recobar"}else{if(C.config.id==="J_weinituijian"||C.config.id==="fn-weinituijian"){f=r+"#ddclick_reco_cart_foru"}else{if(C.config.id.indexOf("similar")>=0){f=r+"#ddclick_reco_cart_similar"}}}}else{f=r}if(g.addToCart){w="<a href='javascript:;' data-item='"+u+"' class='btn_add fn-btn-add'>加入购物车</a>"}else{w="<a title='"+g.name+"' target='_blank' href='"+f+"' data-item='"+u+"' class='btn_add'>查看详情</a>"}y="";if(C.config.id==="J_alsobuy"){if(u>1900000000&&u<2000000000){y="<p class='pl'><a target='_blank' href='"+r+"?ddclick_reco_shoppingcart_recobar#comment_all'>已有<span>"+g.review_cnt+"</span>位用户评价</a></p>"}else{y="<p class='pl'><a target='_blank' href='"+r+"?point=comment_point&ddclick_reco_shoppingcart_recobar'>已有<span>"+g.review_cnt+"</span>位用户评价</a></p>"}}else{if(C.config.id==="J_weinituijian"||C.config.id==="fn-weinituijian"){if(u>1900000000&&u<2000000000){y="<p class='pl'><a target='_blank' href='"+r+"?ddclick_reco_cart_foru#comment_all'>已有<span>"+g.review_cnt+"</span>位用户评价</a></p>"}else{y="<p class='pl'><a target='_blank' href='"+r+"?point=comment_point&ddclick_reco_cart_foru'>已有<span>"+g.review_cnt+"</span>位用户评价</a></p>"}}else{if(C.config.id.indexOf("similar")>=0){if(u>1900000000&&u<2000000000){y="<p class='pl'><a target='_blank' href='"+r+"?ddclick_reco_cart_similar#comment_all'>已有<span>"+g.review_cnt+"</span>位用户评价</a></p>"}else{y="<p class='pl'><a target='_blank' href='"+r+"?point=comment_point&ddclick_reco_cart_similar'>已有<span>"+g.review_cnt+"</span>位用户评价</a></p>"}}}}$request_id=g.request_id;if($request_id==null){$request_id=C.config.request_id}if(g.atmosphereImage==null){p=$("<li request_id='"+$request_id+"'><a href='"+f+"' class='gpic' title='"+g.name+"'><img src='"+n+"' width='150' height='150'> </a><p><a href='"+f+"' target='_blank'>"+g.name+"</a></p><p><span class='price'>¥"+(d.priceNormalize(g.price.salePrice))+"</span></p>"+w+y+"</li>")}else{p=$("<li request_id='"+$request_id+"'><a href='"+f+"' class='gpic' title='"+g.name+"'><img src='"+n+"' width='150' height='150'> <img class='cool_label_52' src='"+g.atmosphereImage+"'></a><p><a href='"+f+"' target='_blank'>"+g.name+"</a></p><p><span class='price'>¥"+(d.priceNormalize(g.price.salePrice))+"</span></p>"+w+y+"</li>")}}else{p=$("<li style='width:150px; height:244px;'></li>")}p.appendTo(q)}if(C.config.id==="J_alsobuy"||C.config.id==="fn-weinituijian"||C.config.id==="J_weinituijian"){x.append(q)}else{k.append(q)}}requestData=function(L,l,i,m){var K="";try{K=DDT.__rpms_line}catch(j){}$.ajax({type:"POST",url:"shopping_cart_add",cache:false,data:{invoke_type:1,product_ids:i,page_tracing:K,referer:window.location.href},dataType:"json",success:function(M){if(M&&M.code===-3){return false}if(0!==M.code&&m){if(100===M.code||102===M.code||228===M.code){L.append("<div class='mask_success wrong'>卖完了</div>");setTimeout(function(){L.find(".mask_success").remove().empty()},1000)}else{if(501===M.code||502===M.code||503===M.code||505===M.code||506===M.code||507===M.code||508===M.code){L.append("<div class='mask_success wrong'>"+M.body["msg"]+"</div>");setTimeout(function(){L.find(".mask_success").remove().empty()},1000)}else{L.append("<div class='mask_success wrong'>加入购物车失败</div>");setTimeout(function(){L.find(".mask_success").remove().empty()},1000)}}}else{L.append("<div class='mask_success'>已成功加入购物车</div>");setTimeout(function(){L.find(".mask_success").remove().empty();cart.show()},1000);return true}},error:function(){$this.remove();L.append("<div class='mask_success wrong'>加入购物车失败</div>");return false}})};H.on("click",".arrow",function(){var l,i,j,m;l=$(this);m=(l.index()===0?-1:1);i=H.data("index");E=H.data("max");j=i+m;if(j>E){j=0}if(j<0){j=E}H.find(".ads_num li").removeClass("on").eq(j).addClass("on");k.find("ul").hide().eq(j).show();H.data("index",j);return false}).on("click",".pageTab",function(){var i,j;j=$(this);i=j.index();H.find(".ads_num li").removeClass("on");j.addClass("on");k.find("ul").hide().eq(i).show();H.data("index",i);return false});return v.find(".ads_box").append(q).append(k)};$(".shopping_ads").on("click",".fn-btn-add",function(){var k,j,g,h,f,i;k=$(this).parent();j=$(this);h=$(this).data("item");g=$("#J_errorBox");i=$('.btn_add[data-item = "'+h+'"]');f=i.data("item");return requestData(k,g,f,i)});$(".shopping_ads[id^='similar'] .fn-btn-add").live("click",function(){var j,i,g,f,h;j=$(this).parent();i=$(this);f=$(this).data("item");g=$("#J_errorBox");h=i;return requestData(j,g,f,h)});$(".shopping_ads[id^='similar'] .fn-close-similar").live("click",function(){$tr=$(this).parentsUntil("tr").parent();id=$tr.attr("id");$similar=$tr.prev("tr").find(".fn-similar");$similar.find("em").removeClass("up");$similar.find("em").addClass("down");$("#"+id).hide()});return e})();d={renderGiftShopTitle:function(e){return"<div class='topic'>"+e+"</div>"},shopSplitBegin:function(){return"<div class='section'>"},shopSplitEnd:function(){return"</div>"},renderGiftMain:function(f,e){return"<div class='topic_gift'><span class='gift_tip'>赠品"+e+"个，可选1个</span>"+f+"</div>"},giftSplitBegin:function(e){if(e>5){return"<div class='roll_list'><a href='javascript:void(0)' class='btn_arr fn-gift-left disable'></a><a href='javascript:void(0)' class='btn_arr right fn-gift-right'></a>"}else{return"<div class='roll_list'><a href='javascript:void(0)' class='btn_arr fn-gift-left disable'></a><a href='javascript:void(0)' class='btn_arr right disable fn-gift-right'></a>"}},giftUlBegin:function(e){if(e){return"<ul class='reduce' style='/* display:none */'>"}else{return"<ul class='reduce' style='display:none'>"}},giftUlEnd:function(){return"</ul>"},giftSplitEnd:function(){return"</div>"},renderGiftInfo:function(f,h,g,i,e){return"<li id='"+i+"_"+f+"_"+e+"'><a class='pic fn-change-gift' target='_blank'><img src='"+(cart.getProductImgUrlWithVersion(0,f,0,g,"m"))+"' width='70' height='70'><span></span></a><p class='introduce'>"+h+"</p></li>"},isFilterCategoryPath:function(e){if(!e){return false}if(e.indexOf("01.58")===0||e.indexOf("01.59")===0||e.indexOf("01.69")===0||e.indexOf("01.73")===0||e.indexOf("01.41.57")===0){return true}else{return false}},isCanCheck:function(e){var s,v,u,t,r,p,A,y,h,o,g,q,z,f,x,w;s=false;z=e.products;v=e.collections;if(z){h=z.length;for(u=p=0,f=h;0<=f?p<f:p>f;u=0<=f?++p:--p){if(z[u].offline!==true&&z[u].stock!==0){s=true;return s}}}if(v){A=v.length;for(t=o=0,x=A;0<=x?o<x:o>x;t=0<=x?++o:--o){q=v[t].productList;if(q){y=q.length;for(r=g=0,w=y;0<=w?g<w:g>w;r=0<=w?++g:--g){if(q[r].offline!==true&&q[r].stock!==0){s=true;return s}}}}}return s},isMoreBuyMoreDirectPrice:function(e){return e===1},isProductGiftOne:function(e){return e===3},isLimitMaxBuy:function(e){return e===5},isShopFullMoneyGift:function(e){return e===12},isShopFullMoneyDirectPrice:function(e){return e===14},isShopFullMoneyDiscount:function(e){return e===15},isFullMoneyDirectPrice:function(e){return e===20},isFullMoneyDiscount:function(e){return e===23},isProductExchange:function(e){return e===28},isProductGiftMore:function(e){return e===30},isAtLastBuy:function(e){return e===51},isSnapUp:function(e){return e===102},isPointFavor:function(e){return e===232},isCollectionFullMoneyGift:function(e){return e===201},isFullCountOneFree:function(e){return e===205},isNFields:function(e){return e===206},isBuyNReduceM:function(e){return e===209},isFullCountDiscount:function(e){return e===207},isPackageWithAppotionBenefit:function(e){return e===225},isAreaMarkert:function(e){return e===228},isEBookExchange:function(e){return e===229},isSecondKill:function(e){return e===230},isPureGift:function(e){return d.isProductGiftOne(e)||d.isProductGiftMore(e)},isPureExchange:function(e){return d.isProductExchange(e)||d.isEBookExchange(e)},isProdGiftPromo:function(e){return d.isPureGift(e)||d.isPureExchange(e)},isSnapUpOrAreaMarket:function(e){return d.isSnapUp(e)||d.isAreaMarkert(e)},isOutletsOrFlashBuy:function(e){return d.isFlashBuy(e)||d.isOutlets(e)||d.isZWorthyBuy(e)},isFlashBuy:function(e){return e.productType==89},isOutlets:function(e){return e.productType==88},isZWorthyBuy:function(e){return e.productType==90||e.productType==90},giftShow:function(f){if(!this.isEBookExchange(f.promotionType)){return true}var e=f.giftList;if(e==null||e.length==0){return false}return f.giftList[0].selected},isEbook:function(e){return e.productId>1900000000&&e.productId<2000000000},isFreeEbook:function(e){return e.productType==97},isOriginalEbook:function(e){return e.productType==95},isEbookGift:function(e){return e.giftId>1900000000&&e.giftId<2000000000},numberCanNotBeChanged:function(e){return d.isEbook(e)||e.stock<=0||e.offline},isNeedShowMobilePrice:function(f){var e;e=true;if(f.mobileExclusivePrice<=0){return false}else{if(f.vipPrice>0&&f.vipPrice<=f.mobileExclusivePrice){return false}else{if(f.salePrice>0&&f.salePrice<=f.mobileExclusivePrice){return false}else{if(f.promoPrice>0&&f.promoPrice<=f.mobileExclusivePrice){return false}}}}return e},GiftLabel:function(g,f,e,i,h){return{promotionLabel:g,promotionColor:f,treeIconColor:e,tableColor:i,colorOnImage:h}},productGiftOne:function(){return new this.GiftLabel("赠品","ebtn egreen","tree_icon egreen","choosen green","icon green")},productGiftMore:function(){return new this.GiftLabel("赠品","ebtn egreen","tree_icon egreen","choosen green","icon green")},productExchange:function(){return new this.GiftLabel("加价购","ebtn eblue","tree_icon eblue","choosen blue","icon blue")},eBookExchange:function(){return new this.GiftLabel("电子书加价购","ebtn eyellow","tree_icon eyellow","choosen yellow","icon yellow")},collectionFullMoneyGift:function(){return new this.GiftLabel("满额赠","ebtn egreen","tree_icon egreen","choosen green","icon green")},getAdaptiveLabelObject:function(e){switch(e){case 3:return this.productGiftOne();case 30:return this.productGiftMore();case 28:return this.productExchange();case 229:return this.eBookExchange();case 201:return this.collectionFullMoneyGift()}},getVipTipByLevel:function(e){switch(e){case 1:return"金卡VIP";case 2:return"钻石VIP";case 3:return"银卡VIP"}},getVipLevel:function(e){switch(e){case 1:return"金卡VIP";case 2:return"钻石VIP";case 3:return"银卡VIP"}},havAreaMarketPrice:function(m){var j,h,f,e,g,n,k;j=false;if(m!=null){n=m.promotionList;if(n&&n.length>0){e=n.length;for(h=f=0,k=e;0<=k?f<k:f>k;h=0<=k?++f:--f){g=n[h];if(d.isAreaMarkert(g.promotionType)){j=true;break}}}}return j},haveSnapUp:function(m){var g,j,f,e,h,n,k;g=false;if(m!=null){n=m.promotionList;if(n&&n.length>0){e=n.length;for(j=f=0,k=e;0<=k?f<k:f>k;j=0<=k?++f:--f){h=n[j];if(d.isSnapUp(h.promotionType)){g=true;break}}}}return g},getSnapUpReduce:function(m){var j,f,e,h,n,k,g;g=0;if(m!=null){n=m.promotionList;if(n&&n.length>0){e=n.length;for(j=f=0,k=e;0<=k?f<k:f>k;j=0<=k?++f:--f){h=n[j];if(d.isSnapUpOrAreaMarket(h.promotionType)){g=h.disPrice;break}}}}return g},getVOrNewOrZ:function(f){var e;e="";if(f!=null){switch(f.productType){case 88:e="<span class='red'>尾品汇</span>";break;case 90:e="<span class='red'>最值当</span>";break;case 91:e="<span class='red'>最值当</span>"}}return e},removeDot:function(e){return(""+e).replace(/.00/g,"")},discountNormalize:function(e){return parseFloat(e/10).toFixed(1)},priceNormalize:function(e){return parseFloat(e).toFixed(2)},eBookIsSelect:function(e){var f,g;f=false;if(e.promotionType===229){if(((g=e.giftList)!=null?g.length:void 0)>0){f=e.giftList[0].selected}}return f},hasBbNone:function(k){var j,m,g,f,e,h;g=false;j=k.promotionList;if((j!=null?j.length:void 0)>0){for(f=e=0,h=j.length;0<=h?e<h:e>h;f=0<=h?++e:--e){m=j[f];if(d.isPureGift(m.promotionType)||d.isProductExchange(m.promotionType)||(d.isEBookExchange(m.promotionType)&&d.eBookIsSelect(m))){g=true;break}}}return g},showProductName:function(e,u){var k,v,t,s,o,j,q,h,g,f,r,p;if(u===void 0||u==="product"){try{if(e.replace(/[^\x00-\xff]/g,"**").length>=102){q=e.length;for(o=j=50,f=q;50<=f?j<f:j>f;o=50<=f?++j:--j){if(e.substr(0,o).replace(/[^\x00-\xff]/g,"**").length>=102){return e.substr(0,o)+"..."}}}return e}catch(v){k=v;return e}}else{if(u==="gift"){try{if(e.replace(/[^\x00-\xff]/g,"**").length>=42){q=e.length;for(o=h=21,r=q;21<=r?h<r:h>r;o=21<=r?++h:--h){if(e.substr(0,o).replace(/[^\x00-\xff]/g,"**").length>=42){return e.substr(0,o)+"..."}}}return e}catch(t){k=t;return e}}else{if(u="gift_selected"){try{if(e.replace(/[^\x00-\xff]/g,"**").length>=64){q=e.length;for(o=g=32,p=q;32<=p?g<p:g>p;o=32<=p?++g:--g){if(e.substr(0,o).replace(/[^\x00-\xff]/g,"**").length>=64){return e.substr(0,o)+"..."}}}return e}catch(s){k=s;return e}}}}},nameIsLong:function(f){var g,e;try{return f.replace(/[^\x00-\xff]/g,"**").length>=102}catch(e){g=e;return false}},prodNumOfOnePackage:function(g,h){var f,e;try{if((h!=null)&&h.promotionType===225){return parseFloat(g/h.collectionNum).toFixed(0)}else{return g}}catch(e){f=e;return g}}};c=(function(){function e(f){this.info=f;this.allProductIds=[];this.ddVipType=0;this.maxIndex=999;this.imageDomain="http://img3x";this.DDDomain=".ddimg.cn/";this.imgN="-1_";this.imgSuffix=".jpg";this.MIN_C2C_PRODUCT_ID=1500000000;this.errorMessage={error_100:"网络连接超时!",error_202:"移入收藏失败",error_203:"删除失败",error_207:"很抱歉，二手书暂不支持收藏。"};this.html_temps={mask:function(){},div_gift:function(S,I){var r,z,V,E,J,F,L,W,O,g,u,U,T,P,x,p,A,N,C,M,h,k,H,K,w,v,t,s,B,G,o,Q;Q="";if(I==null){I={}}try{H=S.promotionType;g=S.giftList;x=g.length;o=Math.ceil(x/6);if(o>3){o=3}G=h="";B=[];h="<div class='pages fn-pages'>";for(U=P=0,K=o;0<=K?P<K:P>K;U=0<=K?++P:--P){if(U!==0){u="display:none"}G+="<ul class='clearfix' style='"+u+"'>";C=U*6+6;if(C>x){C=x}for(T=N=w=U*6,v=C;w<=v?N<v:N>v;T=w<=v?++N:--N){F=g[T];if(d.isCollectionFullMoneyGift(H)){F.collFullGiftTips="";if(S.step<F.step){F.collFullGiftTips="<div class='un_mask'></div><div class='un_tip'>满"+F.buyTotalMoneyCanBeSelect+"元可选该赠品</div>";F.unable="unable"}}F.spuTip="";F.isSPU=0;if(F.spu=="1"){F.spuTip="<a href='javascript:;' class='choose fn-select-spu' style='display:none'>选择属性<span>»</span></a>";F.isSPU=1}J=F.giftId-0;G+="<li class='fn-choose-gift "+(F.unable||"")+"' data-item='"+F.giftId+"_"+I.itemId+"_"+S.promotionId+"_"+F.giftName+"'> <a href='"+(cart.getProductUrl(F.giftId))+"' class='img' target='_blank'><img src='"+(cart.getProductImgUrlWithVersion(0,F.giftId,0,F.imgVersion||0,"m"))+"' width='70' height='70'></a> <div class='info fn-select-gift' data-item='"+F.isSPU+"'><p class='name' title='"+F.giftName+"' style='word-break:break-all;  word-wrap:break-word;'>"+(d.showProductName(F.giftName,"gift"))+"</p> <p><span class='red'>¥"+(d.isPureExchange(H)?d.priceNormalize(F.exchangePrice):"0.00")+"</span><span class='through'>¥"+(d.priceNormalize(F.salePrice))+"</span></p> "+F.spuTip+(F.collFullGiftTips||"")+"</div> </li>";if(F.selected||d.isProductGiftMore(H)){B.push(F)}}h+="<a href='javascript:;' class='"+(U===0?"on":void 0)+"'>"+(U+1)+"</a>";G+="</ul>"}h+="</div>";H=S.promotionType;if(d.isProdGiftPromo(H)){k="购买此商品,可享促销&nbsp;&nbsp;"}else{if(d.isCollectionFullMoneyGift(H)){k="购买<a href='"+(cart.getSpecialPromotionUrl(S.promotionId))+"' class='more' target='_blank'>指定商品</a>，可享促销&nbsp;&nbsp;"}}var q="";var R=" fn-toggle-gift";if(d.isProductExchange(H)){var D=S.giftList;if(D!=null&&D.length>0&&I.isJustGiftHtmlBlockl){A=G+" "+h;return A}var y=I.itemId;q="itemId="+y;R=" fn-toggle-exchange-gift"}A="<p class='event'>"+k+"<a href='javascript:;' class='"+(d.getAdaptiveLabelObject(H).promotionColor)+R+"' "+q+">"+(d.getAdaptiveLabelObject(H).promotionLabel)+"</a></p> <div class='event_list' style='display:none'> "+G+" "+h+" </div>";if(d.isEBookExchange(H)){Q="#ddclick_reco_ebook_shoppingcart"}if(B.length>0){A="";for(O=M=0,t=B.length;0<=t?M<t:M>t;O=0<=t?++M:--M){r=B[O];r.switchSise="";r.color_size="";if(r.saleAttributes&&r.saleAttributes.length>0){s=r.saleAttributes;for(M=0,p=s.length;M<p;M++){att=s[M];r.color_size+="<em>"+att.attributeName+":"+att.selfAttributeValue+"</em>"}if(!NAMESPACE_CART.EAPIDowngradeable_PRODUCT_API_SKU){r.modifyColorAndSize="<a dd_name='修改分色分码' href='javascript:;' class='btn fn-modify-gift' data-item='"+I.itemId+"' data-name='"+r.giftName+"' data-pid='"+r.giftId+"' data-promotionid='"+S.promotionId+"'>修改</a>"}r.switchSise="<div class='swatchsize'>"+(r.modifyColorAndSize||"")+r.color_size+"</div>"}z="";if(d.isPureGift(H)){if(!d.isEbookGift(r)&&r.count>0&&I.prodCount>r.count){z="<span class='red'>库存不够"+I.prodCount+"件</span>"}else{if(r.count<=0){z="<span class='red'>缺货</span>"}}}if(d.isPureExchange(H)){L="<span class='red'>¥"+(d.priceNormalize(r.exchangePrice))+"</span><span class='through'>¥"+(d.priceNormalize(r.salePrice))+"</span>";W="<span class='red'>¥"+(d.priceNormalize(r.exchangePrice))+"</span>"}else{L="<span class='through'>¥"+(d.priceNormalize(r.salePrice))+"</span></span>";W="<span class='red'>¥0.00</span>"}A+="<table width='100%' border='0' cellspacing='0' cellpadding='0' class='"+(d.getAdaptiveLabelObject(H).tableColor)+"'> <tbody> <tr> <td class='row_name'> <a target='_blank' href='"+(cart.getProductUrl(r.giftId))+Q+"' class='goods'><img src='"+(cart.getProductImgUrlWithVersion(0,r.giftId,0,r.imgVersion||0,"m"))+"' width='70' height='70'><span class='"+(d.getAdaptiveLabelObject(H).colorOnImage)+"'>"+(d.getAdaptiveLabelObject(H).promotionLabel)+"</span></a> <a href='"+(cart.getProductUrl(r.giftId))+Q+"' class='name' target='_blank' title='"+r.giftName+"' style='word-break:break-all;  word-wrap:break-word;'>"+(d.showProductName(r.giftName,"gift_selected"))+"</a>"+r.switchSise+"</td> <td class='row3'>"+L+"</td> <td class='fn-count-tip row3'><span class='amount amount_e'>"+r.count+"</span>"+(z||"")+"</td> <td class='row4'>"+W+"</td> <td class='row5'><span>"+(H!==30?"<a href='javascript:;' class='fn-remove-gift' dd_name='删除赠品' data-item='"+r.itemGiftid+"'>删除</a>":"")+"</span></td> </tr> </tbody> </table>"}}if(I.from==="collection"){if(d.isCollectionFullMoneyGift(H)){I.treeClass="tree_last"}else{I.treeClass="tree"}}else{if(I.isLast){I.treeClass="tree_last"}else{I.treeClass="tree"}}if(I.from==="single"){if(!I.isLast){I.hsaBbNone2="bb_none2"}}else{if(I.from==="collection"){if(I.isLastOfCollection){I.hsaBbNone2="bb_none2"}}}if(B.length>0){I.choosenTrClass="choosen_tr"}return"<tr class='"+(I.hsaBbNone2||"")+" "+(I.treeClass||"")+" "+(I.choosenTrClass||"")+"'> <td class='row1'></td> <td class='row_img'><span class='"+(d.getAdaptiveLabelObject(H).treeIconColor)+"'>&nbsp;</span></td> <td class='event_box' colspan='5'> "+A+" </td> </tr>"}catch(E){V=E}},ul_promotions:function(r,o){var n,k,j,m,p,g,h,q;if(r==null){r=[]}if(o==null){o={}}p=r.length;if(p>0){for(n=j=h=p-1;h<=0?j<=0:j>=0;n=h<=0?++j:--j){q=r[n].promotionType;if(d.isProdGiftPromo(q)&&d.giftShow(r[n])){m=n;break}}k=false}return((function(){var i,u,l,v;v=[];for(n=i=0,u=p;0<=u?i<u:i>u;n=0<=u?++i:--i){if(n===m){k=true}g=r[n];if(d.giftShow(g)){var t=((l=g.giftList)!=null?l.length:void 0);var s=d.isProductExchange(g.promotionType);if(t>0||s){v.push(this.div_gift(g,{isLast:k,itemId:o.itemId,from:o.from,isLastOfCollection:o.isLastOfCollection,prodCount:o.itemCount}))}else{continue}}else{continue}}return v}).call(this)).join("")},ul_promotions_for_collgift:function(i,h){var g;if(h==null){h={}}g=i.giftList;if(g.length>0){g.sort(function(l,k){var j;j=i.step;if(l.step<=j&&k.step<=j){return k.step-l.step}else{if(l.step>j&&k.step<=j){return 1}else{if(l.step<=j&&k.step>j){return -1}else{return l.step-k.step}}}})}return this.div_gift(i,{isLast:true,itemId:0,from:"collection"})},subProduct:function(r,n){var m,j,h,g,o,k,q,p;if(r==null){r=[]}if(n==null){n={}}o="";if(r&&r.length>0){p="<tr class='fn-virtual-product-detail' style='display:none'> <td class='row1'></td> <td class='row_img'></td> <td class='event_box' colspan='5'> <table width='100%' border='0' cellspacing='0' cellpadding='0' class='set_list'>";q="";for(m=j=0,h=r.length;0<=h?j<h:j>h;m=0<=h?++j:--j){g=r[m];q+="<tr> <td class='row_name'> <a target='_blank' href='"+(cart.getProductUrl(g.productId))+"' class='goods'><img src='"+(cart.getProductImgUrlWithVersion(g.mainProductId,g.productId,g.numImages,g.imgVersion,"m"))+"' width='80' height='80' /></a> <a href='"+(cart.getProductUrl(g.productId))+"' class='name' title='"+g.productName+"' style='word-break:break-all;  word-wrap:break-word;' target='_blank'>"+g.productName+"</a> </td> <td class='row3'><span class='through'>&yen;"+(d.priceNormalize(g.salePrice))+"</span></td> <td class='fn-count-tip row3'><span class='amount amount_e'>"+g.itemCount+"</span></td> <td class='row4'></td> <td class='row5'></td> </tr>"}k="</table> </td> </tr>"}o=p+q+k;return o},table_shop_title:function(g,n,k){var o,i,j="",h="",l=null;if(n==null){n={}}if(k!=null&&k.couponShopIds!=null){j=k.couponShopIds;if(j.indexOf(",")>-1){l=j.split(",");j=l[0]}}o=function(r){var t,s,q;if(r==null){r={}}if(r.shopBasics){t=r.shopBasics;for(s in t){q=t[s];if((s-0)===r.shopIds[0]){return q}}}};$.extend(true,n,g);n.shop_icon="";n.shopUrl=o(n).shopUrl;if(((i=n.shopUrl)!=null?i.indexOf("http://"):void 0)<0){n.shopUrl="http://"+n.shopUrl}switch(n.showUnitType){case"SELF":n.shopName="<a href='"+n.shopUrl+"' target='_blank'>当当自营</a>";n.shop_icon="<span class='shop_icon'></span>";break;case"EBOOK":n.shopName="<a href='http://e.dangdang.com' target='_blank'>当当电子书</a>";n.shop_icon="<span class='shop_icon store_e'></span>";break;case"MERCHANT":n.shopType=o(n).shopType;n.shopName="<a href='"+n.shopUrl+"' target='_blank'>"+(o(n).shopName)+"</a>";if(n.shopType===6){n.shop_icon="<span class='shop_icon'></span>"}else{n.shop_icon="<span class='shop_icon store_o'></span>"}break;case"OVERSEAS":n.shop_icon="<span class='shop_icon store_h'></span>";n.shopName="<a href='"+n.shopUrl+"' target='_blank'>"+(o(n).shopName)+"</a>";break;case"SELF_MERCHANT_OR_EYES_ENO":n.shop_icon="<span class='shop_icon store_c'></span>";n.shopName=n.collections&&n.collections.length>0?"<a href='"+(cart.getPromotionUrl(n.collections[0].promotionInfo.promotionId))+"' target='_blank'>"+n.collections[0].promotionInfo.promotionName+"</a>":""}n.customerService=n.shopIds[0]!==0?"<a data-item='"+n.shopIds[0]+"' href='javascript:;' class='cse fn-imip'><img src='images/icon_cse.gif'></a>":void 0;if(n.allCheck){n.checked="check_on"}n.shopCanCheck="&nbsp;";if(d.isCanCheck(n)){n.shopCanCheck="<a href='javascript:void(0)' dd_name='选中店铺' class='checknow fn-shop-checkall "+n.checked+"'>选中</a>"}if(n.couponVoList!=null&&n.couponVoList.length!=0){var p="";if(n.showUnitType=="SELF_MERCHANT_OR_EYES_ENO"){p+="promoId_"+n.collections[0].promotionInfo.promotionId}else{if(n.showUnitType=="EBOOK"){p+="eBook_"}$.each(n.shopIds,function(r,q){p+=q+"_"});p=p.substring(0,p.length-1)}n.couponHtml="<td class='coupon_title_td'><div class='coupon_choose' id='coupon_title_"+p+"'><a class='coupon_choose_pointer'>优惠券</a></div>";n.couponHtml+="<div id='coupon_pop_container' style='position: relative;z-index:99;'>";n.couponHtml+="<div id='coupon_pop' class='coupon_pop' data-shopids='"+p+"'>";n.couponHtml+="<ul>";var m=0;$.each(n.couponVoList,function(z,D){m=m+1;n.couponHtml+="<li data-serial-num='"+D.couponModel.activitySerialNum+"' data-everyone-rec-num='"+D.couponModel.activityEveryoneRecNum+"'>";var C=D.couponModel.couponValue;if(D.couponModel.couponType===2||D.couponModel.couponType===3){if(C!=null){C=parseFloat(C)}n.couponHtml+="<div class='coupon_num'>"+C+"折</div>"}else{n.couponHtml+="<div class='coupon_num'>¥"+C+"</div>"}n.couponHtml+="<p>";var E=D.couponModel.couponMinUseValue;if(E>0){if(D.couponModel.couponType===3){E=parseInt(E);n.couponHtml+="满"+E+"件可用"}else{n.couponHtml+="满"+E+"元可用"}}else{n.couponHtml+="无门槛现金券"}n.couponHtml+="<span class='gray'>"+D.couponModel.couponStartDate.substring(0,10)+"至"+D.couponModel.couponEndDate.substring(0,10)+"</span></p>";n.couponHtml+="<a class='show_prodimg'><label class='show_prodimg_label'>购物车内可用此券商品</label><em class='show_prodimg_em'></em></a>";var u="data-coupon-activity='"+D.couponModel.activitySerialNum+"|shoppingcart|||init-no-load'";if(D.couponModel.activityReceivedCrowd!=null&&D.couponModel.activityReceivedCrowd!=""){var r=D.couponModel.activityReceivedCrowd;if(r.indexOf("0")!=-1){n.couponHtml+="<a class='btn' "+u+">领取</a>"}else{if(r.indexOf("3")!=-1){n.couponHtml+="<a class='btn' "+u+">银卡VIP领取</a>"}else{if(r.indexOf("1")!=-1){n.couponHtml+="<a class='btn' "+u+">金卡VIP领取</a>"}else{if(r.indexOf("2")!=-1){n.couponHtml+="<a class='btn' "+u+">钻石VIP领取</a>"}else{n.couponHtml+="<a class='btn' "+u+">领取</a>"}}}}}else{n.couponHtml+="<a class='btn' "+u+">领取</a>"}n.couponHtml+="<div class='coupon_show'>";n.couponHtml+="<div class='title'>";var y="";if(D.couponModel.couponPcUrl!=null&&D.couponModel.couponPcUrl!=""){y+="<a href='"+D.couponModel.couponPcUrl+"' class='go' target='_blank'>去凑单&nbsp;&gt;</a>"}if(D.couponModel.couponMinUseValue==0&&D.checkedCount==0){y+="无门槛礼券，还未选择商品"}else{y+="已选 "+D.checkedCount+" 件，小计 "+D.calculatePrice+" 元，"}if(D.buyAgain==0){y+="已满足使用条件"}else{if(D.couponModel.couponType===3){var v=D.buyAgain;if(v!=null){v=parseInt(v)}else{v=0}y+="还差<span class='red'> "+v+" </span>件可用"}else{y+="还差<span class='red'> "+D.buyAgain+" </span>元可用"}}n.couponHtml+=y;n.couponHtml+="</div>";if(j!=""&&p==j){$(".coupon_pop").each(function(){if($(this).data("shopids")==j){$(this).find("li").each(function(){if($(this).data("serial-num")==D.couponModel.activitySerialNum){$(this).find(".coupon_show").each(function(){$(this).find(".title").each(function(){$(this).html(y)})})}})}})}if(D.couponProductList.length<=5){n.couponHtml+="<a class='coupon_arrow' style='display:none;'></a><a class='coupon_arrow right' style='display:none;'></a>"}else{n.couponHtml+="<a class='coupon_arrow'></a><a class='coupon_arrow right'></a>"}n.couponHtml+="<div class='coupon_show_list'>";n.couponHtml+="<ul class='coupon_show_list_ul' data-current-start-num='1'>";var x=0;var F="",w="",B="",t="",q="",s="",A="";$.each(D.couponProductList,function(K,I){x++;var J=I.mainProductId;var H=I.numImages;var G=I.imgVersion;if(x<=5){n.couponHtml+="<li id='img_seq_"+x+"'>";n.couponHtml+="<span class='item'><img src='"+cart.getProductImgUrlWithVersion(J,I.productId,H,G,"m")+"'>";n.couponHtml+="<a href='javascript:void(0)' data-item='"+I.itemId+"' data-current_groupinfo='"+p+"' data-shopId='"+I.shopId+"' data-groupinfo='"+I.groupInfo+"' data-coupon_serial_num='"+D.couponModel.activitySerialNum+"' ";if(I.checked==true){n.couponHtml+="class='fn-product-check-for-coupon checknow check_on'>选中</a>"}else{n.couponHtml+="class='fn-product-check-for-coupon checknow'>未选中</a>"}n.couponHtml+="</span>";if(I.groupInfo!=null&&I.groupInfo.indexOf("promoId_")>-1){n.couponHtml+="<div class='tag_line'><span class='tag'>跨店铺促销</span></div>"}n.couponHtml+="<span>¥"+I.price+"</span>";n.couponHtml+="<span>x"+I.itemCount+"</span>";n.couponHtml+="</li>"}if(D.couponProductList.length>5){s+=I.shopId+",";F+=I.itemId+",";w+=cart.getProductImgUrlWithVersion(J,I.productId,H,G,"m")+",";B+=I.price+",";t+=I.itemCount+",";q+=I.checked+",";A+=I.groupInfo+","}if(j!=""&&p==j){$(".coupon_pop").each(function(){if($(this).data("shopids")==j){$(this).find("li").each(function(){if($(this).data("serial-num")==D.couponModel.activitySerialNum){$(this).find(".coupon_show").each(function(){$(this).find(".coupon_show_list_ul").each(function(){$(this).find("li").each(function(){if($(this).find("a").data("item")==I.itemId){var L="<span class='item'><img src='"+cart.getProductImgUrlWithVersion(J,I.productId,H,G,"m")+"'>";L+="<a href='javascript:void(0)' data-item='"+I.itemId+"' data-current_groupinfo='"+p+"' data-shopId='"+I.shopId+"' data-groupinfo='"+I.groupInfo+"' data-coupon_serial_num='"+D.couponModel.activitySerialNum+"' ";if(I.checked==true){L+="class='fn-product-check-for-coupon checknow check_on'>选中</a>"}else{L+="class='fn-product-check-for-coupon checknow'>未选中</a>"}L+="</span>";if(I.groupInfo!=null&&I.groupInfo.indexOf("promoId_")>-1){L+="<div class='tag_line'><span class='tag'>跨店铺促销</span></div>"}L+="<span>¥"+I.price+"</span>";L+="<span>x"+I.itemCount+"</span>";L+="</li>";$(this).html(L)}})})})}})}})}});n.couponHtml+="</ul>";if(D.couponProductList.length>5){s=s.substring(0,s.length-1);F=F.substring(0,F.length-1);w=w.substring(0,w.length-1);B=B.substring(0,B.length-1);t=t.substring(0,t.length-1);q=q.substring(0,q.length-1);A=A.substring(0,A.length-1);n.couponHtml+="<input type='hidden' value='"+s+"' id='shopIdStrInput' />";n.couponHtml+="<input type='hidden' value='"+F+"' id='itemIdStrInput' />";n.couponHtml+="<input type='hidden' value='"+w+"' id='prodImgStrInput' />";n.couponHtml+="<input type='hidden' value='"+B+"' id='prodPriceStrInput' />";n.couponHtml+="<input type='hidden' value='"+t+"' id='prodCountStrInput' />";n.couponHtml+="<input type='hidden' value='"+q+"' id='prodCheckedStrInput' />";n.couponHtml+="<input type='hidden' value='"+A+"' id='groupInfoStrInput' />";n.couponHtml+="<input type='hidden' value='"+p+"' id='currentGroupInfoStrInput' />";n.couponHtml+="<input type='hidden' value='"+D.couponModel.activitySerialNum+"' id='couponSerialNumInput' />";if(j!=""&&p==j){$(".coupon_pop").each(function(){if($(this).data("shopids")==j){$(this).find("li").each(function(){if($(this).data("serial-num")==D.couponModel.activitySerialNum){$(this).find(".coupon_show").each(function(){$(this).find(".coupon_show_list").each(function(){$(this).find("#shopIdStrInput").val(s);$(this).find("#itemIdStrInput").val(F);$(this).find("#prodImgStrInput").val(w);$(this).find("#prodPriceStrInput").val(B);$(this).find("#prodCountStrInput").val(t);$(this).find("#prodCheckedStrInput").val(q);$(this).find("#groupInfoStrInput").val(A);$(this).find("#currentGroupInfoStrInput").val(p);$(this).find("#couponSerialNumInput").val(D.couponModel.activitySerialNum)})})}})}})}}n.couponHtml+="</div>";n.couponHtml+="</li>"});n.couponHtml+="</ul>";n.couponHtml+="</div>";n.couponHtml+="</div></td>"}else{n.couponHtml=""}return"<table border='0' cellspacing='0' cellpadding='0' class='shop_title'> <tbody> <tr> <td>"+n.shopCanCheck+"</td> <td>"+n.shop_icon+"</td> <td>"+n.shopName+"</td>"+n.couponHtml+" <td>"+(n.customerService||"")+"</td> <td></td> </tr> </tbody></table>"},tr_shop_end:function(h,p,n){var j,o,u,l,m,k;if(p==null){p={}}$.extend(true,p,h);l="<td colspan='2'>&nbsp;</td>";u="<td colspan=3'>&nbsp;";m=0;if(p.showUnitType!=="SELF_MERCHANT_OR_EYES_ENO"){if((j=p.shopPromoList)!=null?j[0]:void 0){o=p.shopPromoList[0];if(d.isShopFullMoneyGift(o.promotionType)){var q=o.giftList;if(q!=null&&q.length!==0){if(o.step<=0&&o.buyAgain>=0){var i=q[0].stock;if(i>0){l="<td colspan='2' class='intro'>再买"+(d.priceNormalize(o.buyAgain))+"元，可选店铺赠品</b>"}}else{if(o.currentFavor>0){var g="";var r="";$.each(q,function(C,z){var y=z.stock;if(y<=0){return true}var D=z.selected;var A=z.canBeSelected;if(D===false&&A===false){return true}var B=z.giftId;var H=0;var x=z.giftName;var G=o.promotionId;var F=o.shopId;var E="_";var v=B+E+H+E+G+E+"0"+E+F;if(D===true){g=x;r+="<div class='item on' data-item='"+v+"'>"}else{r+="<div class='item' data-item='"+v+"'>"}var w="http://product.dangdang.com/"+B+".html";r+="<a target='_blank' href='"+w+"'><div class='img'><img src='"+(cart.getProductImgUrl(0,B,0,"m"))+"'></div></a>";r+="<a class='fn-select-gift' href='javascript:void(0)'>";r+="<div class='product_info'><div class='pr_name'>"+x+"</div>";r+="<div class='price'><span class='now_price'>¥0.00</span><span class='origin_pr'>¥"+z.salePrice+"</span></div></div>";if(D===true){r+="<div class='select'></div>"}r+="</a>";r+="</div>"});if(r!==""){var s=g;if(s.length>13){s=s.substring(0,13);s+="..."}l="<td colspan='2' class='intro'>已满"+(d.priceNormalize(o.currentFavor))+"元，已领取店铺赠品：<b class='red'>"+s+"</b>";l+="&nbsp;&nbsp;<a href='javascript:void(0)' class='choose_shop_gift more'><b>重新选择</b></a>";l+="<div id='shop_gift_list' class='gift_select new_gift_select' style='top:80%;left:5%;position:absolute;display:none;'><div class='gift_product_list'><div class='list clearfix'>";l+=r;l+="</div></div></div>";l+="</td>"}}}}}else{if(d.isShopFullMoneyDirectPrice(o.promotionType)){if(o.step<=0&&o.buyAgain>=0){l="<td colspan='2' class='intro'>购买店铺商品，再买"+(d.priceNormalize(o.buyAgain))+"元，可减<b class='red'>"+(d.priceNormalize(o.firstStepDis))+"</b>元</td>"}else{l="<td colspan='2' class='intro'>购买店铺商品，已满"+(d.priceNormalize(o.currentFavor))+"元，已减<b class='red'>"+(d.priceNormalize(o.currentDis))+"</b>元</td>"}}else{if(d.isShopFullMoneyDiscount(o.promotionType)){if(o.step<=0&&o.buyAgain>=0){l="<td colspan='2' class='intro'>购买店铺商品，再买"+(d.priceNormalize(o.buyAgain))+"元，可享<b class='red'>"+(d.discountNormalize(o.firstStepDis))+"</b>折</td>"}else{l="<td colspan='2' class='intro'>购买店铺商品，已满"+(d.priceNormalize(o.currentFavor))+"元，享受<b class='red'>"+(d.discountNormalize(o.currentDis))+"</b>折</td>"}}}}}}k="";if(p.showUnitType==="SELF"){sortedProductIds=(function(){var x,v,A,z,w;A=h.products||[];z=[];w=[];if(h.collections){for(var y=0;y<h.collections.length;y++){A=A.concat(h.collections[y].productList)}}for(v=0,x=A.length;v<x;v++){product=A[v];w.push({prodId:product.productId,createTime:(product.creationDateForSpuPormo||product.creationDate||0)})}w.sort(function(C,B){if(C.createTime>B.createTime){return -1}else{if(C.createTime<B.createTime){return 1}else{return 0}}});for(v=0,x=w.length;v<x;v++){z.push(w[v].prodId)}return z})();var t=window.district.get_cookie_province_id();if(NAMESPACE_CART.shippingExcludeProvince.indexOf(","+t+",")==-1&&n==false){if(false===NAMESPACE_CART.isLogin){if(p.totalMoney<NAMESPACE_CART.shippingThreshold){k="<span class='shipping_tip'>满"+NAMESPACE_CART.shippingThreshold+"元包邮 <a href='javascript:;' class='more'  data-categoryid='2' data-pids='"+sortedProductIds+"' data-stockids='"+p.wareHouseIds+"' data-topprice='"+d.priceNormalize(p.maxPrice)+"' data-pricediff='"+d.priceNormalize(59-p.totalMoney)+"' data-totalprice='"+d.priceNormalize(p.totalMoney)+"'>免运费凑单</a></span>"}}else{if(cart.ddVipType==2){if(p.totalMoney<NAMESPACE_CART.shippingThreshold){k="<span class='shipping_tip'>满"+NAMESPACE_CART.shippingThreshold+"元包邮 <a href='javascript:;' class='more' data-categoryid='2' data-pids='"+sortedProductIds+"' data-stockids='"+p.wareHouseIds+"' data-topprice='"+d.priceNormalize(p.maxPrice)+"' data-pricediff='"+d.priceNormalize(59-p.totalMoney)+"' data-totalprice='"+d.priceNormalize(p.totalMoney)+"'>免运费凑单</a></span>"}}else{if(p.totalMoney<NAMESPACE_CART.shippingThreshold){k="<span class='shipping_tip'>满"+NAMESPACE_CART.shippingThreshold+"元包邮 <a href='javascript:;' class='more' data-categoryid='2' data-pids='"+sortedProductIds+"' data-stockids='"+p.wareHouseIds+"' data-topprice='"+d.priceNormalize(p.maxPrice)+"' data-pricediff='"+d.priceNormalize(59-p.totalMoney)+"' data-totalprice='"+d.priceNormalize(p.totalMoney)+"'>免运费凑单</a></span>"}}}}}if(p.totalShopBenefit>0){u="<td colspan='3' class='row4'><span class='red big alignright'>&yen;"+(d.priceNormalize(p.totalMoney))+"</span><span class='save alignright'>已减<em>&yen;"+(d.priceNormalize(p.totalShopBenefit))+"</em></span>"}else{u="<td colspan='3' class='row4'><span class='red big ooline alignright'>&yen;"+(d.priceNormalize(p.totalMoney))+"</span>"+k}u+="</td>";return"<tr class='total'> <td class='row1'>&nbsp;</td> <td class='row_img'>店铺合计</td> "+l+" "+u+" </tr>"},table_product:function(P,R){var O,E,h,ag,ac,s,q,k,ab,aa,Y,S,I,J,M,ad,U,z,al,aj,ai,ah,y,x,w,v,u,t,r,p,am,K,G,T,A,g,X,L;if(R==null){R={}}$.extend(true,R,P);R.show_price_red=false;R.vip_mobile_promo_label="";R.price_reduce_head="<div class='low_price fn-up' style='display:none;'>优惠价格<em></em><div class='low_pop' style='display:none'><ul>";R.price_reduce_foot="</ul></div></div>";R.price_reduce_body="";if(R.priceChange){R.price_reduce_body+="<li>· 比上一次进入购物车价格下降"+(d.removeDot(-d.priceNormalize(R.priceChange)))+"元</li>"}if(d.getSnapUpReduce(R)!==0&&!R.vip&&!R.vip){R.price_reduce_body+="<li>· 限时抢促销优惠"+(d.removeDot(d.priceNormalize(d.getSnapUpReduce(R))))+"元</li>"}if(R.vip||R.shopVip){if(d.haveSnapUp(R)){switch(cart.ddVipType){case 1:R.price_reduce_body+="<li>· 金卡VIP抢购";break;case 2:R.price_reduce_body+="<li>· 钻石VIP抢购";break;case 3:R.price_reduce_body+="<li>· 银卡VIP抢购"}}else{R.price_reduce_body+="<li>· "+(d.getVipLevel(cart.ddVipType))}if(R.vipDiscount){R.price_reduce_body+="享受"+(d.removeDot(d.priceNormalize(R.vipDiscount)))+"折，优惠"+(d.priceNormalize(d.removeDot(d.priceNormalize(R.salePrice)-d.priceNormalize(R.vipPrice))))+"元</li>"}else{R.price_reduce_body+="，优惠"+(d.removeDot(d.priceNormalize(d.priceNormalize(R.salePrice)-d.priceNormalize(R.vipPrice))))+"元</li>"}}if(R.from==="collection"){J=R.collectionPromoInfo;if(d.isFullMoneyDirectPrice(J.promotionType)){R.price_reduce_body+="<li>· 享受满额减优惠";U=R.collectionPromoInfo.stepsInfo;for(ac=0,s=U.length;ac<s;ac++){G=U[ac];R.price_reduce_body+="，满"+G.favor+"减"+G.dis}R.price_reduce_body+="</li>"}}if(d.isNeedShowMobilePrice(R)){R.price_reduce_body+="<li>· 手机购买价"+(d.removeDot(d.priceNormalize(R.mobileExclusivePrice)))+"元<li>"}if(R.price_reduce_body){R.price_reduce_body=R.price_reduce_head+R.price_reduce_body+R.price_reduce_foot}if(R.promoPrice>0){R.show_price=R.promoPrice}else{R.show_price=R.salePrice}if(R.vip||R.shopVip){R.show_price=R.vipPrice;try{if(R.promoPrice&&(d.priceNormalize(R.promoPrice)-d.priceNormalize(R.vipPrice)<0)){R.show_price=R.promoPrice}}catch(F){err=F}if(d.haveSnapUp(R)){R.show_price_red=true;switch(cart.ddVipType){case 1:R.vip_mobile_promo_label+="<span class='red'>金卡VIP抢购价</span>";break;case 2:R.vip_mobile_promo_label+="<span class='red'>钻石VIP抢购价</span>";break;case 3:R.vip_mobile_promo_label+="<span class='red'>银卡VIP抢购价</span>"}}else{R.vip_mobile_promo_label=R.vip?"<span class='red'>"+(d.getVipTipByLevel(cart.ddVipType))+"</span>":"<span class='red'>店铺VIP价</span>"}}else{if(d.haveSnapUp(R)){R.show_price_red=true;R.vip_mobile_promo_label+="<span class='red'>限时抢购价 </span>"}}if(d.havAreaMarketPrice(R)){R.vip_mobile_promo_label+="<span class='red'>区域促销</span>"}R.vip_mobile_promo_label+=d.getVOrNewOrZ(R);if(d.isNeedShowMobilePrice(R)){R.vip_mobile_promo_label+="<span class='red'>手机购买价更低</span>"}if(R.checked){if(R.ebookGift&&d.isEbook(R)){R.product_money="¥0.00"}else{R.product_money="¥"+d.priceNormalize(R.itemTotalMoney)}}else{R.product_money="¥0.00"}if(R.from==="collection"&&d.isMoreBuyMoreDirectPrice((z=R.collectionPromoInfo)!=null?z.promotionType:void 0)&&R.salePrice>R.promoPrice&&R.promoPrice>0&&!d.isFilterCategoryPath(R.categoryPath)){R.through_sale_price="<span class='through'>¥"+(d.priceNormalize(R.salePrice))+"</span>"}R.ebook_gift_tips=R.ebookGift&&d.isEbook(R)?"<div class='price_tip'><span></span>购物车中重复购买该电子书，结算时只保留一本</div>":"";R.tips="";R.limit_buy_label="";R.minBuyCount="";R.maxBuyCount="";R.productPromotionTag="";R.dangdangPrice="";R.mobile_recomend="";var j=R.promotionList;var ae=false;if(j!=null&&j.length>0){y=R.promotionList;for(ab=0,q=y.length;ab<q;ab++){ad=y[ab];if(d.isSnapUpOrAreaMarket(ad.promotionType)&&!d.isFilterCategoryPath(R.categoryPath)){if(R.checked){R.tips=ad.maxLimitBuy<R.itemCount?"<div class='price_tip'><span></span>"+ad.maxLimitBuy+"件以内享受促销价,超出部分按照当当价结算</div>":""}R.through_sale_price="<span class='through'>¥"+(d.priceNormalize(R.salePrice))+"</span>"}if(d.isLimitMaxBuy(ad.promotionType)&&ad.maxLimitBuy<=R.itemCount&&!(d.isOutletsOrFlashBuy(R)&&R.outletsLimitBuyNum>0)){R.maxBuyCount=ad.maxLimitBuy;R.limit_buy_label="<span class='most red fn-err-msg'>限购"+ad.maxLimitBuy+"件</span>"}if(d.isSecondKill(ad.promotionType)){R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>"}if(d.isSnapUp(ad.promotionType)){if(ad.activityTag!=null&&ad.activityTag!=""){R.productPromotionTag="<span class='red'>"+ad.activityTag+"</span>"}else{R.productPromotionTag="<span class='red'>限时抢</span>"}R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>"}if(d.isAreaMarkert(ad.promotionType)){R.productPromotionTag="<span class='red'>区域促销</span>";R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>"}if(d.isAtLastBuy(ad.promotionType)&&!(d.isOutletsOrFlashBuy(R)&&R.outletsLimitBuyNum>0)){R.limit_buy_label="<span class='most red fn-err-msg'>"+ad.minBuyCount+"件更优惠</span>";R.minBuyCount=ad.minBuyCount;if(R.itemCount===ad.minBuyCount){R.count_of_promo_51="class='default'"}}if(d.isPointFavor(ad.promotionType)){ae=true;R.productPromotionTag="<div class='bonus_points'>";R.productPromotionTag+="<div class='item_content_text'>";R.productPromotionTag+="<div style='float:left'>";R.productPromotionTag+="<a href='javascript:void(0)' data-item='"+R.itemId+"' class='fn-point-favor-check checknow ";if(ad.usePoint==true){var af;if(ad.maxLimitBuy>0){af=ad.pointNum*(R.itemCount>ad.maxLimitBuy?ad.maxLimitBuy:R.itemCount)}else{af=ad.pointNum*R.itemCount}R.productPromotionTag+=" check_on'>选中</a></div><div class='a_item'>已享银铃铛购<BR/>下单扣"+af+"银铃铛</div>";if(ad.maxLimitBuy>0&&R.itemCount>ad.maxLimitBuy){R.productPromotionTag+='<span class="fn-err-msg red">限购'+ad.maxLimitBuy+"件，超出部分将以"+R.salePrice+"元/件结算</span>"}}else{R.productPromotionTag+=" '>选中</a></div><div class='a_item'>使用"+ad.pointNum+"银铃铛<br/>享<font class='red'>"+ad.promoPrice+"</font>元优惠价";if(ad.maxLimitBuy>0&&ad.maxLimitBuy<10000){R.productPromotionTag+="<br/>（限"+ad.maxLimitBuy+"件）"}R.productPromotionTag+="</div>"}R.productPromotionTag+="</div>";R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>";if(R.error.reason&&"checkPointResultInfo"===R.error.reason&&R.itemId==R.error.itemId){R.productPromotionTag+='<div class="fn-err-msg red">'+R.error.errorMsg+"</div>"}R.productPromotionTag+="</div>"}}}R.canSelectPromotionArea="";var W=R.canSelectPromotionList;if(W!=null&&W.length>0){X=R.canSelectPromotionList;R.canSelectPromotionArea+='<div class="promote_select"><div class="hover_btn">';R.canSelectPromotionArea+='<span class="promote">促销<span class="drop_down"></span></span>';R.canSelectPromotionArea+='<div class="show_info">';var C="";for(ab=0,q=X.length;ab<q;ab++){L=X[ab];R.canSelectPromotionArea+='<div class="item" promotionid="'+L.promotionId+'">';if(L.selected==true){C=L.promotionId;R.canSelectPromotionArea+='<span class="select on"></span>'}else{R.canSelectPromotionArea+='<span class="select"></span>'}R.canSelectPromotionArea+='<span class="promote_information">';var H="",ao,B,D;var an=L.stepsInfo||[];if(L.promotionId==0){H=L.promotionName}else{if(L.autoRoll==true){switch(L.promotionType){case 20:H+="每购满"+an[0].buy_total_money+"元，可减"+an[0].direct_price+"元";break;case 206:H+="每购满"+an[0].buy_total_num+"件可享受"+an[0].direct_price+"元"+an[0].buy_total_num+"件";break;case 209:H+="每买"+an[0].buy_total_num+"件免"+an[0].free_count+"件";break}}else{switch(L.promotionType){case 1:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="购满"+ao.buy_total_num+"件，可享"+ao.discount+"折；"}break;case 20:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="购满"+ao.buy_total_money+"元，可减"+ao.direct_price+"元；"}break;case 23:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="购满"+ao.buy_total_money+"元，可享"+ao.discount+"折；"}break;case 201:H+="购满";var ak="";for(D=0,B=an.length;D<B;D++){ao=an[D];ak+=ao.buy_total_money+"元、"}if(ak!=""){ak=ak.substring(0,ak.length-1)}H+=ak+"送赠品；";break;case 205:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="购满"+ao.buy_total_num+"件，可享最低价商品0元；"}break;case 206:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="购满"+ao.buy_total_num+"件，可享"+ao.direct_price+"元"+ao.buy_total_num+"件；"}break;case 207:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="购满"+ao.buy_total_num+"件，可享"+ao.discount+"折；"}break;case 209:for(D=0,B=an.length;D<B;D++){ao=an[D];H+="买"+ao.buy_total_num+"件免"+ao.free_count+"件；"}break}if(H!=""){H=H.substring(0,H.length-1)}}}if(H==""){H=L.promotionName}R.canSelectPromotionArea+=H+"</span></div>"}R.canSelectPromotionArea+='<div class="btn_confirm">';R.canSelectPromotionArea+='<span class="btn confirm" itemid="'+R.itemId+'" currentpromid="'+C+'">确定</span>';R.canSelectPromotionArea+='<span class="btn cancel" originalpromid="'+C+'">取消</span>';R.canSelectPromotionArea+="</div></div></div></div>"}if(R.error.reason&&"choicePromotion"===R.error.reason&&R.itemId==R.error.itemId){R.productPromotionTag+='<span class="fn-err-msg red">选择的促销已失效</span>'}R.productPromotionTag=R.productPromotionTag||d.getVOrNewOrZ(R);var V="";if(ae==true){V=R.productPromotionTag}if(R.shopVip){R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>";R.productPromotionTag="<span class='red'>店铺VIP</span>"+V}if(R.vip){switch(cart.ddVipType){case 1:R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>";R.productPromotionTag="<span class='red'>金卡VIP</span>"+V;break;case 2:R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>";R.productPromotionTag="<span class='red'>钻石VIP</span>"+V;break;case 3:R.dangdangPrice="<span class='through'>¥"+R.salePrice+"</span>";R.productPromotionTag="<span class='red'>银卡VIP</span>"+V}}if(d.isNeedShowMobilePrice(R)&&R.dangdangPrice==""){R.mobile_recomend="<span class='red'>手机购买价更低</span>"}R.pre_sale=R.preSale?"<span class='booking'>[预售]</span>":void 0;R.clazz=R.stock<=0||R.offline?"none":void 0;if(R.offline||R.stock<=0){if(R.offline&&R.stock<=0){R.offlineTip="<span class='oos'>下架</span>"}else{R.nomore=R.stock<=0?"<span class='oos'>缺货</span>":void 0;R.offlineTip=R.offline?"<span class='oos'>下架</span>":void 0}}else{if(d.isFreeEbook(R)){R.clazz="none";R.offlineTip="<span class='oos'>免费</span>"}else{if(d.isOriginalEbook(R)){R.clazz="none";R.offlineTip="<span class='oos'>原创</span>"}}}if(R.stock>0&&R.stock<R.itemCount){R.stock_tip="<span class='red'>库存紧张</span>"}h="";alert_html="";E={changeCount:R.itemCount};if(R.error.reason&&"changeProductCount"===R.error.reason&&!R.stock_tip){E=cart.changeProductCountTips(R.error);h=E.errorMsg;alert_html=E.alertMsg}if(d.numberCanNotBeChanged(R)){R.count="<span class='amount amount_e'>"+R.itemCount+"</span>"}else{if(E.itemId&&E.itemId===R.itemId&&!R.stock_tip){R.count="<span class='amount fn-updatecount "+(R.maxBuyCount?"red":"")+"' data-value='"+R.itemCount+"'><a dd_name='减少数量' href='javascript:void(0)' "+(R.count_of_promo_51||"")+">-</a><input data-value='"+R.itemCount+"' value='"+R.itemCount+"' type='text'><a dd_name='增加数量' href='javascript:void(0)'>+</a></span>"+h}else{R.count="<span class='amount fn-updatecount "+(R.maxBuyCount?"red":"")+"' data-value='"+R.itemCount+"'><a dd_name='减少数量' href='javascript:void(0)' "+(R.count_of_promo_51||"")+">-</a><input data-value='"+R.itemCount+"' value='"+R.itemCount+"' type='text'><a dd_name='增加数量' href='javascript:void(0)'>+</a></span>"}}R.firstTd="&nbsp;";if(R.checked){R.firstTd="<a href='javascript:void(0)' data-item='"+R.itemId+"' class='fn-product-check checknow check_on'>选中</a>"}else{R.firstTd="<a href='javascript:void(0)' data-item='"+R.itemId+"' class='fn-product-check checknow'>选中</a>"}if(R.offline||R.stock<=0||d.isFreeEbook(R)||d.isOriginalEbook(R)){R.firstTd="&nbsp;"}R.operate="&nbsp;";if(R.offline){R.operate="<span><a dd_name='删除单个下架品' href='javascript:void(0)' data-item='"+R.itemId+"' class='fn-remove-product'>删除</a></span>"}else{if(!NAMESPACE_CART.EAPIDowngradeable_WISHLIST){var N={cartItemId:R.itemId,productId:R.productId};R.operate="<span><a href='javascript:void(0)' data-cartitemid='"+R.itemId+"' data-productid="+R.productId+" data-mainproductid="+R.mainProductId+" data-productname='"+R.productName+"' data-saleprice="+R.salePrice+" data-categorypath='"+R.categoryPath+"' data-item-detail='"+JSON.stringify(N)+"' class='fn-add-wish' dd_name='加入收藏按钮'>移入收藏</a></span><span><a href='javascript:void(0)' data-item='"+R.itemId+"' class='fn-remove-product' dd_name='删除普通品'>删除</a></span>"}else{R.operate="<span><a href='javascript:void(0)' data-item='"+R.itemId+"' class='fn-remove-product' dd_name='删除普通品'>删除</a></span>"}}if(R.offline||R.stock<=0){}if(R.from==="collection"){M=(x=R.collectionPromoInfo)!=null?x.promotionType:void 0;if(d.isPackageWithAppotionBenefit(M)){if(R.isFirstOfCollection){if(!NAMESPACE_CART.EAPIDowngradeable_WISHLIST){R.operate="<span><a href='javascript:void(0)' data-item='"+R.allItemIds+"' class='fn-add-wish' dd_name='加入收藏按钮'>移入收藏</a></span><span><a href='javascript:void(0)' data-item='"+R.allItemIds+"' class='fn-remove-product' dd_name='删除套餐'>删除</a></span>"}else{R.operate="<span><a href='javascript:void(0)' data-item='"+R.allItemIds+"' class='fn-remove-product' dd_name='删除套餐'>删除</a></span>"}if(((w=R.collectionPromoInfo)!=null?w.checked:void 0)===true){R.firstTd="<a href='javascript:void(0)' data-item='"+R.allItemIds+"' class='fn-product-check checknow check_on'>选中</a>"}else{R.firstTd="<a href='javascript:void(0)' data-item='"+R.allItemIds+"' class='fn-product-check checknow'>选中</a>"}R.itemId=R.allItemIds}else{R.operate="&nbsp;";R.firstTd="&nbsp;"}}}R.virtual_detail=R.subProduct&&R.subProduct.length>0?"<a dd_name='虚拟品商品明细' href='javascript:;' class='ebtn fn-virtual-bind-show'>商品明细</a>":void 0;if(d.nameIsLong(R.productName)){R.productNameShorter=d.showProductName(R.productName);R.shorter=true}if(R.shorter){R.showName=R.productNameShorter}else{R.showName=R.productName}R.color_size="";if(R.saleAttributes&&R.saleAttributes.length>0){v=R.saleAttributes;for(aa=0,k=v.length;aa<k;aa++){O=v[aa];R.color_size+="<em>"+O.attributeName+":"+O.selfAttributeValue+"</em>"}if(!NAMESPACE_CART.EAPIDowngradeable_PRODUCT_API_SKU){R.modifyColorAndSize="<a dd_name='修改分色分码' href='javascript:;' class='btn fn-switchsize' data-mainproductid='"+P.mainProductId+"' data-numimages='"+P.numImages+"' data-item='"+P.itemId+"' data-name='"+P.productName+"' data-pid='"+P.productId+"'>修改</a>"}R.switchSise="<div class='swatchsize'>"+(R.modifyColorAndSize||"")+R.color_size+"</div>";if(E.itemId&&E.itemId===R.itemId&&alert_html!=""){R.tips="<div class='price_tip'><span></span>同一商品的不同色码或规格共限购"+R.spuLimitBuyNum+"件</div>"}}if(R.from==="single"||(R.from==="collection"&&d.isCollectionFullMoneyGift((u=R.collectionPromoInfo)!=null?u.promotionType:void 0))){R.color="class= 'red' "}if(R.from==="collection"){if(d.isNFields((t=R.collectionPromoInfo)!=null?t.promotionType:void 0)){}else{if(d.isPackageWithAppotionBenefit((r=R.collectionPromoInfo)!=null?r.promotionType:void 0)){R.packageNumOfProd="<span class='num'>数量："+(d.prodNumOfOnePackage(R.itemCount,R.collectionPromoInfo))+"</span>";R.packageStyleCtrl5td=" n_set fn-special";R.packageStyleCtrl7td=" n_set n_setr fn-special";if(R.isFirstOfCollection){if(E.itemId&&E.itemId===R.allItemIds){R.count="<span class='amount' data-value='"+R.itemCount+"'><a dd_name='减少套餐数量' href='javascript:void(0)'>-</a><input data-item='"+R.batchId+"' data-value='"+((p=R.collectionPromoInfo)!=null?p.collectionNum:void 0)+"' value='"+((al=R.collectionPromoInfo)!=null?al.collectionNum:void 0)+"' type='text'><a dd_name='增加套餐数量' href='javascript:void(0)'>+</a></span><span>套餐商品仅支持成套购买</span>"+h}else{R.count="<span class='amount' data-value='"+R.itemCount+"'><a dd_name='减少套餐数量' href='javascript:void(0)'>-</a><input data-item='"+R.batchId+"' data-value='"+((aj=R.collectionPromoInfo)!=null?aj.collectionNum:void 0)+"' value='"+((ai=R.collectionPromoInfo)!=null?ai.collectionNum:void 0)+"' type='text'><a dd_name='增加套餐数量' href='javascript:void(0)'>+</a></span><span>套餐商品仅支持成套购买</span>"}}else{R.count="&nbsp;";if(E.itemId&&E.itemId===R.allItemIds){R.stock_tip="&nbsp;"}}}}}R.hasPromotion=R.promotionList.length>0;if(R.from==="single"){if(R.promotionList&&R.promotionList.length>0){for(ag=Y=0,ah=R.promotionList.length;0<=ah?Y<ah:Y>ah;ag=0<=ah?++Y:--Y){I=R.promotionList[ag];if(d.isPureGift(I.promotionType)||d.isProductExchange(I.promotionType)||(d.isEBookExchange(I.promotionType)&&d.eBookIsSelect(I))){R.headLine="tree_first";break}else{R.headLine=""}}}}if(R.from==="single"){if(d.hasBbNone(P)){R.bbNone="bb_none"}}else{if(R.from==="collection"){if(R.isLastOfCollection||d.hasBbNone(P)){R.bbNone="bb_none"}}}R.trClass=(R.bbNone||"")+" "+(R.headLine||"")+" "+(R.clazz||"");price_class="";if(R.productPromotionTag!=""){price_class=" class='price_n'"}K=d.priceNormalize(R.show_price);S="<span"+price_class+">¥"+K+"</span>";if(R.checked){if(R.limitScope=="SPU"&&R.overSpuLimitBuyNum==1){R.tips="<div class='price_tip'><span></span>同一商品的不同色码或规格共限购"+R.spuLimitBuyNum+"件</div>"}}A="<tr id='tr_"+R.itemId+"' class='"+R.trClass+"'> <td class='row1'> "+R.firstTd+(R.nomore||"")+(R.offlineTip||"")+" </td> <td class='row_img'> <a href='"+(cart.getProductUrl(R.productId))+"' target='_blank' dd_name='查看详情'> <img onmouseout='$(this).parent().next().hide()' onmouseover='$(this).parent().next().show()' src='"+(cart.getProductImgUrlWithVersion(R.mainProductId,R.productId,R.numImages,R.imgVersion,"m"))+"' width='80' height='80'> ";if(R.labelInfoList){var Q=R.labelInfoList[0].atmosphere56ImageUrl;if(Q){A=A+"<img class='cool_label_30' src='"+Q+"'></a>"}else{A=A+"</a>"}A=A+"<div style='display: none;' class='img_big'><a href='"+(cart.getProductUrl(R.productId))+"' dd_name='查看详情' target='_blank'><img src='"+(cart.getProductImgUrlWithVersion(R.mainProductId,R.productId,R.numImages,R.imgVersion||0,"b"))+"'>";var Z=R.labelInfoList[0].atmosphere100ImageUrl;if(Z){A=A+"<img class='cool_label_70' src='"+Z+"'></a>"}else{A=A+"</a>"}}else{A=A+"</a><div style='display: none;' class='img_big'><a href='"+(cart.getProductUrl(R.productId))+"' dd_name='查看详情' target='_blank'><img src='"+(cart.getProductImgUrlWithVersion(R.mainProductId,R.productId,R.numImages,R.imgVersion||0,"b"))+"'></a>"}A=A+"<span class='arrow'></span></div> </td> <td class='row_name'> <div class='name'> <a href='"+(cart.getProductUrl(R.productId))+"' title='"+R.productName+"' target='_blank' dd_name='查看详情' style='word-break:break-all;  word-wrap:break-word;'>"+(R.pre_sale||"")+R.showName+"</a></div> ";if(R.priceChange){A+="<div class='price_down red";if(R.switchSise||R.virtual_detail){A+=" mt"}A+="'>比加入购物车时降低"+parseFloat((-d.priceNormalize(R.priceChange))).toFixed(2)+"元</div>"}A+=(R.packageNumOfProd||"")+" "+(R.switchSise||"")+" "+(R.tips||"")+" "+(R.ebook_gift_tips||"")+" "+(R.virtual_detail||"")+" </td> <td class='row3'>"+S+(R.price_reduce_body||"")+(R.productPromotionTag||"")+(R.canSelectPromotionArea||"")+(R.mobile_recomend||"")+"</td> <td data-minbuy='"+(R.minBuyCount?R.minBuyCount:0)+"' class='fn-count-tip row3 "+(R.packageStyleCtrl5td||"")+"'>"+R.count+(R.limit_buy_label||"")+(R.stock_tip||"")+"</td> <td class='row4'><span "+(R.color||"")+">"+(R.product_money||"")+"</span></td> <td class='row5 "+(R.packageStyleCtrl7td||"")+"'>"+R.operate+"</td> </tr>";g="";T="";tr_similar="";if(R.hasPromotion){T=this.ul_promotions(R.promotionList,{itemId:R.itemId,from:R.from,isLastOfCollection:R.isLastOfCollection,itemCount:R.itemCount})}if(R.subProduct){g=this.subProduct(R.subProduct)}if(R.offline||R.stock<=0){tr_similar="<tr id='tr_similar_"+R.productId+"' class='none' style='display:none'><td class='row1'></td><td class='row_img'>&nbsp;</td><td class='event_box' colspan='5'><div class='shopping_ads' id='similar_"+R.productId+"'></div></td></tr>"}return A+g+T+tr_similar},extractAllItemIdFromColl:function(h){var k,n,j,g,o,m;n="";o=h.productList;if(o&&o.length>0){o.sort(function(l,i){return parseFloat(l.itemId)-parseFloat(i.itemId)});g=o.length;for(k=j=0,m=g;0<=m?j<m:j>m;k=0<=m?++j:--j){n+=o[k].itemId+","}n=n.substring(0,n.length-1);return n}},table_collection:function(s,o){var m,v,D,h,A,E,x,w,B,t,z,y,p,C,G,l,j,r,k,n,q,H,g,F,u;if(o==null){o={}}try{$.extend(true,o,s);if(o.productList==null){o.productList=[]}C=o.productList.length;w="tree_first";G=(j=s.promotionInfo)!=null?j.promotionType:void 0;u="tree_first";if(d.isFullMoneyDirectPrice(G)||d.isFullMoneyDiscount(G)||d.isFullCountDiscount(G)||d.isCollectionFullMoneyGift(G)||d.isNFields(G)||d.isBuyNReduceM(G)){u="tree_line"}m=(function(){var N,Q,P,O,L,M,J,I,i,W,V,U,T,S,R;R=[];for(B=N=0,W=C;0<=W?N<W:N>W;B=0<=W?++N:--N){w=(function(){switch(B){case 0:return u;default:return"tree_line"}})();y=false;t=false;if(d.isPackageWithAppotionBenefit(G)){y=true;v=this.extractAllItemIdFromColl(s)}t=(function(){switch(B){case 0:return true;default:return false}})();z=(function(){switch(B){case C-1:return true;default:return false}})();r="";if(d.isFullMoneyDirectPrice(G)&&B===0){q="，";V=s.promotionInfo.stepsInfo||[];for(M=0,Q=V.length;M<Q;M++){n=V[M];q+="满"+n.favor+"减"+n.dis+"元；"}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满额减</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满额减' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isFullMoneyDiscount(G)&&B===0){q="，";U=s.promotionInfo.stepsInfo||[];for(J=0,P=U.length;J<P;J++){n=U[J];q+="满"+n.buy_total_money+"元享"+(d.discountNormalize(n.disCount))+"折；"}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满额折</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满额折' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isFullCountDiscount(G)&&B===0){q="，";T=s.promotionInfo.stepsInfo||[];for(I=0,O=T.length;I<O;I++){n=T[I];q+="满"+n.buy_total_num+"件享"+(d.discountNormalize(n.discount2))+"折；"}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满N件折</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满N件折' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isBuyNReduceM(G)&&B===0){q="，";T=s.promotionInfo.stepsInfo||[];var K="买N免M";if(T.length>0){K="买"+T[0].favor+"免"+T[0].dis}if(s.promotionInfo.autoRoll==true&&T.length>0){q+="每买"+T[0].favor+"件免"+T[0].dis+"件"}else{for(I=0,O=T.length;I<O;I++){n=T[I];q+="买"+n.favor+"件免"+n.dis+"件，"}if(q){q=q.substring(0,q.length-1)}}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>"+K+"</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='"+K+"' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isCollectionFullMoneyGift(G)&&B===0){q="";k="";S=s.promotionInfo.giftList||[];for(i=0,L=S.length;i<L;i++){x=S[i];if(k){if(k!==x.step){q+=x.buyTotalMoneyCanBeSelect+"、";k=x.step}}else{k=x.step;q+="，购物满"+x.buyTotalMoneyCanBeSelect+"、"}}if(q){q=q.substring(0,q.length-1)+"元送赠品"}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>满额赠</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='满额赠' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}if(d.isNFields(G)&&B===0){q="，";V=s.promotionInfo.stepsInfo||[];if(V.length==0){q+="满"+s.promotionInfo.buyTotalNum+"件"+s.promotionInfo.specialPrice+"元；"}else{for(M=0,Q=V.length;M<Q;M++){n=V[M];q+="满"+n.favor+"件"+n.dis+"元；"}}if(q){q=q.substring(0,q.length-1)}r="<tr class='tree_slogan'><td class='row1'>&nbsp;</td><td class='row_img'><span class='tree_icon slogan'>N元场</span></td><td class='event_box' colspan='5'><p class='event'><a target='_blank' dd_name='N元场' href='"+(cart.getPromotionUrl(s.promotionInfo.promotionId))+"'>"+s.promotionInfo.promotionName+q+"</a></p></td></tr>"}r+=this.table_product(o.productList[B],{headLine:w,collectionPromoInfo:s.promotionInfo,from:"collection",isFirstOfCollection:t,isLastOfCollection:z,error:o.error,allItemIds:v});R.push(r)}return R}).call(this)}catch(A){h=A}l=s.promotionInfo;try{if(l){if(l.disPrice>0){D="<div class='n_total'><span class='red'>¥"+(d.priceNormalize(l.collectionPrice))+"</span><span class='save'>已减<em>¥"+(d.priceNormalize(l.disPrice))+"</em></span></div>"}else{D="<div class='n_total'><span class='red ooline'>¥"+(d.priceNormalize(l.collectionPrice))+"</span></div>"}if(d.isFullMoneyDirectPrice(l.promotionType)){if(l.currentDis<=0||l.disPrice<=0){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+(d.priceNormalize(l.buyAgain))+"元，享受<span class='ebtn ered'>满"+l.nextFavor+"减"+l.nextDis+"元</span></p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已减<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已减<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元；再买<b class='red'>"+(d.priceNormalize(l.buyAgain))+"</b>元，可享受<span class='ebtn ered'>满"+l.nextFavor+"元减"+l.nextDis+"</span></p> </td>"}}}if(d.isFullMoneyDiscount(l.promotionType)){if(l.currentDis<=0||l.disPrice<=0){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+(d.priceNormalize(l.buyAgain))+"元，享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠；再买<b class='red'>"+(d.priceNormalize(l.buyAgain))+"</b>元可享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}}}if(d.isFullCountOneFree(l.promotionType)){if(l.disPrice<=0){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+l.buyAgain+"件，最低价商品<b class='red'>0</b>元</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已满"+l.currentFavor+"件，免除最低价商品<b class='red'>"+(d.priceNormalize(l.disPrice))+"</b>元</p> </td>"}}if(d.isFullCountDiscount(l.promotionType)){if(0>=(l.currentFavor-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，再买"+l.buyAgain+"件，可享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已享受<b class='red'>"+(d.discountNormalize(l.currentDis))+"</b>折优惠；再买<b class='red'>"+l.buyAgain+"</b>件，可享受<b class='red'>"+(d.discountNormalize(l.nextDis))+"</b>折优惠</p> </td>"}}}if(d.isBuyNReduceM(l.promotionType)){if(0>=(l.currentFavor-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>， 再买"+l.buyAgain+"件，可免<b class='red'>"+l.nextDis+"</b>件</p> </td>"}else{if(0>=(l.buyAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已免<b class='red'>"+l.currentDis+"</b>件</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+"<p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>， 已免<b class='red'>"+l.currentDis+"</b>件；再买<b class='red'>"+l.buyAgain+"</b>件，可免<b class='red'>"+l.nextDis+"</b>件</p> </td>"}}}if(d.isMoreBuyMoreDirectPrice(l.promotionType)){if(0===(l.meetBuyTotalNum-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买此商品</a>，再买"+l.bugAgain+"件，享受<b class='red'>"+l.nextFavoreDiscount+"</b>折优惠</p> </td>"}else{if(0===(l.bugAgain-0)){H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买此商品</a>，已享受<b class='red'>"+l.favorDiscount+"</b>折优惠</p> </td>"}else{H="<td class='event_box' colspan='5'> "+D+" <p class='event'>购买此商品，已享受<b class='red'>"+l.favorDiscount+"</b>折优惠；再买<b class='red'>"+l.bugAgain+"</b>件可享受<b class='red'>"+l.nextFavoreDiscount+"</b>折优惠</p> </td>"}}}if(d.isPackageWithAppotionBenefit(l.promotionType)){if(!l.checked){F="<p class='event'>套餐购买更优惠</p>"}else{F="<p class='event'>购买此套餐</a>，已减<b class='red'>"+(d.priceNormalize(l.disPrice))+"</b>元</p>"}H="<td class='event_box' colspan='5'> "+D+" "+F+" </td>"}if(d.isNFields(l.promotionType)){if(0>=(l.currentFavor-0)){g="<p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>"+l.nextFavor+"件，可享受<b class='red'>"+(d.priceNormalize(l.nextDis))+"</b>元<b class='red'>"+l.nextFavor+"</b>件促销</p>"}else{if(l.collectionProductCount==l.currentFavor){g="<p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已满"+l.currentFavor+"件，享受<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元<b class='red'>"+l.currentFavor+"</b>件促销</p>"}else{g="<p class='event'>购买<a href='"+(cart.getPromotionUrl(l.promotionId))+"' class='more' target='_blank'>指定商品</a>，已满"+l.currentFavor+"件，价格最高的商品享受<b class='red'>"+(d.priceNormalize(l.currentDis))+"</b>元<b class='red'>"+l.currentFavor+"</b>件</p>"}}H="<td class='event_box' colspan='5'> "+D+" "+g+" </td>"}if(d.isCollectionFullMoneyGift(l.promotionType)){p=this.ul_promotions_for_collgift(l)}else{p="<tr class='tree_last n_set_total'> <td class='row1'></td> <td class='row_img'><span class='tree_icon ered'></span></td> "+H+" </td> </tr>"}}}catch(E){h=E}return m.join("")+p}}}e.prototype.transfer=function(M){var I,y,A,s,H,L,K,J,G,f,r,g,u,F,E,D,C,q,h,t,x,w,v,z,B;I=this;if(M.body.globalInfo!==null){this.ddVipType=M.body.globalInfo.ddVipType}try{this.allProductList=[];this.allProductIds=[];B=M.body.shopVos;if((B!=null?B.length:void 0)>0){u=B.length;for(L=G=0,t=u;0<=t?G<t:G>t;L=0<=t?++G:--G){z=B[L];if(z.products&&z.products.length>0){g=z.products.length;for(C=F=0,x=g;0<=x?F<x:F>x;C=0<=x?++F:--F){q=z.products[C];this.allProductList.push(q)}}if(z.collections&&z.collections.length>0){A=z.collections;f=A.length;for(K=E=0,w=f;0<=w?E<w:E>w;K=0<=w?++E:--E){y=A[K];if(y.productList&&y.productList.length>0){h=y.productList;r=h.length;for(J=D=0,v=r;0<=v?D<v:D>v;J=0<=v?++D:--D){q=h[J];this.allProductList.push(q);if(!y.creationDate||y.creationDate<q.creationDate){y.creationDate=q.creationDate}}}}}}this.allProductList.sort(function(j,i){return parseFloat(i.creationDate)-parseFloat(j.creationDate)});for(L=0;L<this.allProductList.length;L++){this.allProductIds.push(this.allProductList[L].productId)}}}catch(H){s=H}this.info=M.body;(function(){var n,m,l,j,i;try{if(cart.allProductIds.length>0){$.ajax({url:"tuijian?pids="+cart.allProductIds.join(","),dataType:"json",success:function(O){var p,R,Q,o,P,N;if(O.code!==0){return false}p=((R=O.body[0])!=null?R.items:void 0)||[];p=p.slice(0,(p.length>100?100:p.length)||[]);if(p.length>=10){new a({uid:"买了又买",title:"根据购物车中的商品为您推荐",id:"J_alsobuy",length:p.length,request_id:(Q=O.body[0])!=null?Q.request_id:void 0,provider:function(X){var W,S,U,T,V;S=[];for(V=0,T=p.length;V<T;V++){U=p[V];if(U.adinfo.ad_id!==0){W={};W.product_id=U.productId;W.ad_id=U.ad_id;W.review_cnt=U.reviewCnt;W.ad_user=U.adinfo.uid;W.cost=U.adinfo.cost;S.push(W)}}if(S.length>0){return $.ajax({type:"POST",url:"ad_encrypt",dataType:"json",async:false,data:{adinfo:JSON.stringify(S),rdm:window.DDAD_RDM},success:function(Z){if(Z&&Z.code===-3){return false}var Y,aa,ab;if(Z!==null){for(ab=0,Y=p.length;ab<Y;ab++){aa=p[ab];if(aa.adinfo.ad_id!==0){if(Z[""+aa.productId]!==""){aa.product_url=Z[""+aa.productId]}}}}return X.render((function(){var ac,ae,ad,af;ae=[];for(ad=0,ac=p.length;ad<ac;ad++){U=p[ad];if(U.isSPU==1||U.isMain==true){af=false}else{af=true}ae.push({name:U.productName,price:{salePrice:parseFloat(U.salePrice)/100},pid:U.productId,review_cnt:U.reviewCnt,addToCart:af,isMonitor:true,request_id:U.requestId,imgVersion:U.imgVersion,atmosphereImage:U.atmosphereImageUrl})}return ae})())}})}else{return X.render((function(){var Y,aa,Z,ab;aa=[];for(Z=0,Y=p.length;Z<Y;Z++){U=p[Z];if(U.isSPU==1||U.isMain==true){ab=false}else{ab=true}aa.push({name:U.productName,price:{salePrice:parseFloat(U.salePrice)/100},pid:U.productId,review_cnt:U.reviewCnt,addToCart:ab,isMonitor:true,request_id:U.requestId,imgVersion:U.imgVersion,atmosphereImage:U.atmosphereImageUrl})}return aa})())}}})}o=((P=O.body[1])!=null?P.items:void 0)||[];if(o.length>=10){$("#J_weinituijian").show();new a({uid:"为您推荐",title:"为您推荐",id:"J_weinituijian",request_id:(N=O.body[1])!=null?N.requestId:void 0,length:O.body[1].items.length,provider:function(T){var S;S=(function(){var U,W,Y,V,X;Y=O.body[1].items.slice(0,(O.body[1].items.length>50?50:O.body[1].items.length)||[]);V=[];for(W=0,U=Y.length;W<U;W++){q=Y[W];if(q.isSPU==1){X=false}else{X=true}V.push({name:q.productName,price:{salePrice:q.salePrice/100},pid:q.productId,review_cnt:q.reviewCnt,addToCart:X,isMonitor:true,request_id:q.requestId,imgVersion:q.imgVersion,atmosphereImage:q.atmosphereImageUrl})}return V})();return T.render(S)}})}}})}else{$("#J_weinituijian").hide();$("#J_alsobuy").hide()}}catch(n){s=n}try{if(cart.allProductIds.length===0){j=a.prototype.ignoreList;if((j!=null?j.length:void 0)>0){i=j.indexOf("最近浏览");if(i!==-1){j.pop(i)}}$.ajax({url:"recent_view",dataType:"json",success:function(o){if(o.code!==0){return false}if((o.body==null)||o.body.length===0){return false}return new a({uid:"最近浏览",title:"最近浏览",id:"fn-recent-view",length:o.body.length,provider:function(N){var p;p=(function(){var O,Q,R,P;R=o.body.slice(0,o.body.length||[]);P=[];for(Q=0,O=R.length;Q<O;Q++){q=R[Q];P.push({name:q.productName,price:{salePrice:q.salePrice},pid:q.productId,addToCart:true,mainProductId:q.mainProductId,numImages:q.numImages,imgVersion:q.imgVersion,atmosphereImage:q.atmosphereImageUrl})}return P})();return N.render(p)}})}})}else{$("#fn-recent-view").hide()}}catch(m){s=m}try{if(cart.allProductIds.length===0){$.ajax({url:"recommend_view",dataType:"json",success:function(o){if(o.code!==0){return false}if(o.body==null||o.body.items==null||o.body.items.length<10){return false}$("#fn-weinituijian").show();return new a({uid:"空购物车为您推荐",title:"为您推荐",id:"fn-weinituijian",request_id:(ref5=o.body)!=null?ref5.requestId:void 0,length:o.body.items.length,provider:function(N){var p;p=(function(){var O,Q,S,P,R;S=o.body.items.slice(0,(o.body.items.length>50?50:o.body.items.length)||[]);P=[];for(Q=0,O=S.length;Q<O;Q++){q=S[Q];if(q.isSPU==1){R=false}else{R=true}P.push({name:q.productName,price:{salePrice:q.salePrice/100},pid:q.productId,review_cnt:q.reviewCnt,addToCart:R,isMonitor:true,request_id:q.requestId,imgVersion:q.imgVersion,atmosphereImage:q.atmosphereImageUrl})}return P})();return N.render(p)}})}})}else{$("#fn-weinituijian").hide()}}catch(k){s=k}try{if(NAMESPACE_CART.isLogin){return $.ajax({url:"list_wish_new",dataType:"json",success:function(p){var o;if(p.code!==0){return false}o=p.body||[];if(o.length<5){return false}return new a({uid:"我的收藏",title:"我的收藏",id:"fn-my-wish",length:o.length,provider:function(O){var N;return O.render((function(){var P,R,Q,S;Q=[];for(R=0,P=o.length;R<P;R++){N=o[R];if(N.mainProductId!=0){S=false}else{S=true}Q.push({pid:N.productId,name:N.productName,price:{salePrice:N.salePrice},addToCart:S,mainProductId:N.mainProductId,numImages:N.numImages,imgVersion:N.imgVersion})}return Q})())}})}})}else{j=a.prototype.ignoreList;if((j!=null?j.length:void 0)>0){i=j.indexOf("我的收藏");if(i!==-1){j.pop(i)}}return $("#fn-my-wish").hide()}}catch(l){s=l}})();return true};e.prototype.dialog=function(){};e.prototype.render=function(y,h){var f,g,v,r,k,u,x,w,n,l,o,z,j,i,q,B,A,s,p,t,m;if(h!=null&&h.couponShopIds!=null){t=h.couponShopIds;if(t.indexOf(",")>-1){m=t.split(",");t=m[0]}else{m=null}}else{t="";m=null}if(h==null){h={}}v=this;if(!!y){if(y.code!=null&&y.code===-3){return false}s=this.transfer(y)}if(!s){return}try{$("#J_cartLoading").hide();if(this.info.globalInfo===null||this.info.globalInfo.cartProductCount===0){f=$(".fn-shops").empty();$("#empty").show();$(".shopping_total").hide();$("#cart").hide();$("#district").hide();$("#payAmount").text("¥0.00");$("#totalFavor").text("¥0.00");$(".shopping_total_left span").text("已选择0件商品")}else{l=v.info.globalInfo;if(l){$("#payAmount").text("¥"+parseFloat(l.payAmount).toFixed(2));$("#totalFavor").text("¥"+parseFloat(l.totalFavor).toFixed(2));$(".shopping_total_left span").html('已选择<font color="red">'+l.productCount+"</font>件商品")}$("#empty").hide();$("#cart").show();$("#district").show();$(".shopping_total").show();if(l.payAmount&&l.payAmount>0){$(".shopping_total .fn-checkout").removeClass("unable")}else{$(".shopping_total .fn-checkout").addClass("unable")}}}catch(u){k=u}(function(C){var N,L,I,S,J,R,Q,M,H,E,G,P,D,O;if(C){if(t==""){f=$(".fn-shops").empty()}R=$("<div>");H=true;for(E=0,G=C.length;E<G;E++){D=C[E];var F="";if(D.showUnitType=="SELF_MERCHANT_OR_EYES_ENO"){F+="promoId_"+D.collections[0].promotionInfo.promotionId}else{if(D.showUnitType=="EBOOK"){F+="eBook_"}$.each(D.shopIds,function(U,T){F+=T+"_"});F=F.substring(0,F.length-1)}if(H&&!D.allCheck){H=false}S=$("<div>").addClass("fn-shop");S.attr("data-shopIds",F);O=v.html_temps.table_shop_title(D,null,h);L=$("<div>").addClass("shopping_list");L.attr("data-shopIds",F);Q=$('<table width="100%" border="0" cellspacing="0" cellpadding="0"></table>');I=(function(){var U,T,W,V;W=D.products||[];V=[];for(T=0,U=W.length;T<U;T++){P=W[T];V.push("<tbody data-stock='"+P.stock+"' data-offline='"+P.offline+"' data-productid='"+P.productId+"' data-timestamp='"+(P.creationDateForSpuPormo||P.creationDate||0)+"' data-orderForSpuPormo='"+(P.orderForSpuPormo||0)+"'>"+(v.html_temps.table_product(P,{from:"single",error:h}))+"</tbody>")}return V})();var K=false;if(y.body.hasCheckedFreeShippingFeeProduct!=undefined){K=y.body.hasCheckedFreeShippingFeeProduct}J="<tfoot>"+(v.html_temps.tr_shop_end(D,{},K))+"</tfoot>";Q.append(I);N=(function(){var U,T,W,V;W=D.collections||[];V=[];for(T=0,U=W.length;T<U;T++){M=W[T];V.push("<tbody data-productid='0' data-timestamp='"+(M.creationDateForSpuPormo||M.creationDate||0)+"' data-orderForSpuPormo='"+(M.orderForSpuPormo||0)+"'>"+(v.html_temps.table_collection(M,{error:h}))+"</tbody>")}return V})();Q.append(N);$(Q.children("tbody").detach().sort(function(W,V){var U,Z,T,Y,X;Y=$(W).data("stock");X=$(V).data("stock");U=$(W).data("offline");Z=$(V).data("offline");if(Y===0||U===true){if(X!==0&&Z!==true){return 1}}else{if(X===0||Z===true){return -1}}T=-($(W).data("timestamp")-$(V).data("timestamp"));if(T===0){T=-($(W).data("orderForSpuPormo")-$(V).data("orderForSpuPormo"));if(T===0){T=-(parseFloat($(W).data("productid"))-parseFloat($(V).data("productid")))}}return T})).appendTo(Q);Q.find("tbody:last tr:last").addClass("bb_none");Q.append(J);if(D.showUnitType==="SELF"){$shipping=$("<div class='shipping_add' style='display:none;'></div>");S.append(O,L.append(Q),$shipping)}else{S.append(O,L.append(Q))}if(t==""){R.append(S)}else{$(".fn-shop").each(function(){if($(this).data("shopids")==F){if(F==t){$(this).find(".shopping_list").each(function(){if($(this).data("shopids")==F){$(this).html(L.children())}})}else{if(m!=null&&m.length>0){for(var T=1;T<m.length;T++){var U=m[T];if(F==U&&t!=U){$(this).html(S.children())}}}}}})}}if(t==""){f.html(R.children())}if(H){$("#cart .fn-checkall").addClass("check_on");$(".shopping_total_left .fn-checkall").addClass("check_on")}else{$("#cart .fn-checkall").removeClass("check_on");$(".shopping_total_left .fn-checkall").removeClass("check_on")}}})(this.info.shopVos);try{n=function(){var C,E,D;if(i<=0){clearInterval(window.timer);return location.reload()}else{--i;D=i%60;E=Math.floor((i%3600)/60);C=Math.floor(i/3600);$("#J_limitedMinute").html(E+"分");$("#J_limitedSecond").html(D+"秒");if(!v.info.trueHaveOutlets){$("#weipinboxarea #weipinhui").hide()}if(!v.info.haveZWorthyBuy){$("#weipinboxarea #zuizhidang").hide()}g.show()}};if(this.info.haveOutlets&&this.info.timePass>0){g=$("#weipinboxarea");q=this.info.timePass-0;i=q-0+3;j=i%60;z=Math.floor(i/60);clearInterval(window.timer);window.timer=setInterval(n,1000)}else{$("#weipinboxarea #weipinhui").hide();$("#weipinboxarea #zuizhidang").hide();$("#weipinboxarea").hide();clearInterval(window.timer)}}catch(x){k=x}try{if(h.ischeckorder){cart.checkOrder()}cart.imipOnlineCheck();A=$(".shopping_total").offset().top;o=$("#hide_div").offset().top;B=$(document).scrollTop();p=$(window).height();r=$(".shopping_total").parent();if((A-0)-(o-0)<=20){if(parseFloat(B)+parseFloat(p)<parseFloat(A)){return r.css("position","fixed")}}else{if(parseFloat(A)>=parseFloat(o)){return r.css("position","static")}}}catch(w){k=w}};e.prototype.mergeLogin=function(){return $.ajax({type:"GET",url:"mergeCart",cache:false,success:function(f){if(0===f.code){return window.location.reload(true)}}})};e.prototype.cartLogin=function(){if(false===NAMESPACE_CART.isLogin){return showMsgBox("","","",cart.mergeLogin,"","","shopping")}};e.prototype.getPromotionUrl=function(f){var g;return g=NAMESPACE_CART.PROMO_BASE_URL+f};e.prototype.getSpecialPromotionUrl=function(f){var g;return g=NAMESPACE_CART.PROMO_BASE_URL+f};e.prototype.getShopUrl=function(f){return"http://shop.dangdang.com/"+f};e.prototype.getProductUrl=function(f){var g;return g=NAMESPACE_CART.PROD_BASE_URL+f+".html"};e.prototype.getProductImgUrl=function(g,h,f,i){var j;g=g-0;h=h-0;f=f-0;if(f===0&&g!==0){return j=cart.imageDomain+g%10+cart.DDDomain+g%99+"/"+g%37+"/"+g+cart.imgN+i+cart.imgSuffix}else{return j=cart.imageDomain+h%10+cart.DDDomain+h%99+"/"+h%37+"/"+h+cart.imgN+i+cart.imgSuffix}};e.prototype.getProductImgUrlWithVersion=function(h,i,f,g,j){var k;h=h-0;i=i-0;f=f-0;g=g-0;if(f===0&&h!==0){return k=cart.imageDomain+h%10+cart.DDDomain+h%99+"/"+h%37+"/"+h+cart.imgN+j+(g===0?"":"_"+g)+cart.imgSuffix}else{return k=cart.imageDomain+i%10+cart.DDDomain+i%99+"/"+i%37+"/"+i+cart.imgN+j+(g===0?"":"_"+g)+cart.imgSuffix}};e.prototype.countTimer=void 0;e.prototype.updateCount=function(g){var f;f={newCount:g.newCount,oldCount:g.oldCount,itemId:g.cartItemId,from:g.from,trTarget:g.trTarget,target:g.target,productId:g.productId};clearTimeout(this.countTimer);return this.countTimer=setTimeout(function(){var h;h=$.ajax({type:"GET",url:"update_count",cache:false,data:{itemIds:g.cartItemId,count:g.newCount},dataType:"json"});return h.then(function(i){if(i.code===-3){return false}if(i.code===0){}else{f.reason="changeProductCount";if(i.code===121){f.oldCount=i.body["data"]["atLeastBuyNum"];f.errorCode=121}if(i.code===144){f.errorMsg=i.body["msg"];f.errorCode=144}if(i.code===124){if(i.body["data"]["promotionType"]&&i.body["data"]["promotionType"]=="5"){}else{f.oldCount=i.body["data"]["maxBuyNum"];f.errorCode=124}}if(i.code===128){f.oldCount=i.body["data"]["maxBuyNum"];f.productId=i.body["data"]["productId"];f.errorCode=128}if(i.code===143){f.errorMsg=i.body["msg"];f.errorCode=143}if(i.code===100){f.errorMsg=i.body["msg"];f.errorCode=100}if(i.code===809){f.reason="checkPointResultInfo";f.errorMsg=i.body["msg"];f.itemId=i.body["data"]["cartItemId"];f.errorCode=i.code}}f.couponNotRefresh=true;return cart.show(f)},function(i){return alert(cart.errorMessage.error_100)})},200)};e.prototype.checkNum=function(g){var f,i,h;i=0;h=this;if(isNaN(g.newCount)){g.target.val(g.oldCount);g.available=false;return false}f=/^\d+$/;if(!f.test(g.newCount)){g.target.val(g.oldCount);g.available=false;return false}if(g.newCount-0<0){g.target.val(g.oldCount);g.available=false;return false}if(g.newCount<g.minLimitBuy){if(g.oldCount>g.newCount){g.target.val(g.oldCount);g.newCount=g.oldCount;g.available=false;if(!g.changeTipTarget.find(".fn-err-msg")){g.changeTipTarget.append('<span class="fn-err-msg red">未达到购买数量</span>')}return false}else{g.num=g.minLimitBuy;g.newCount=g.minLimitBuy;g.available=true;return true}}if(g.maxLimitBuy>0&&g.newCount>g.maxLimitBuy){if(g.newCount>g.oldCount){g.newCount=g.oldCount;g.target.val(g.oldCount);if(!g.changeTipTarget.find("fn-err-msg")){g.changeTipTarget.append('<span class="fn-err-msg red">超过数量上限</span>')}g.available=false;return false}else{g.target.val(g.maxLimitBuy);g.newCount=g.maxLimitBuy;g.available=true;return true}}g.available=true;return true};e.prototype.changePackageCount=function(f){var g;f.minLimitBuy=0;f.maxLimitBuy=10000;f.changeTipTarget=f.target.parent();cart.checkNum(f);if(f.available){clearTimeout(this.countTimer);return this.countTimer=setTimeout(function(){},g=$.ajax({type:"GET",url:"update_package_count",cache:false,data:{batch_id:f.batchId,count:f.newCount},dataType:"json"}),g.then(function(h){if(h.code===-3){return false}var i;if(h.code===0){}else{f.reason="changeProductCount";i=h.body["msg"];f.errorCode=h.code;if(h.code===433){f.oldCount=h.body["data"]["maxBuyNum"]}else{if(h.code===124){f.oldCount=h.body["data"]["maxBuyNum"]}else{if(h.code===128){f.oldCount=h.body["data"]["maxBuyNum"]}else{if(h.code===121){f.oldCount=h.body["data"]["atLeastBuyNum"]}}}}}return cart.show(f)},function(h){return alert(cart.errorMessage.error_100)},200))}else{return f.target.val(f.oldCount)}};e.prototype.commit=function(f,g){var i,h;i=this;if(this.commition){if(typeof(h=this.commition).reject==="function"){h.reject()}}this.commition=$.ajax({url:f,cache:false,dataType:"json"});this.commition.always(function(){return i.commition=void 0}).then(function(j){i.render(j,g);if(g!=null&&g.initPage!=null){couponDict.bindEvent()}},function(j){});return this.commition};e.prototype.show=function(f){this.commit("newShow",f)};e.prototype.checkProductType=function(f){f=f-0;if(f<this.MIN_C2C_PRODUCT_ID){return 0}if(f>=1900000000&&f<=2000000000){return 2}if(f>=1500000000&&f<=1800000000){return 1}else{return 0}};e.prototype.uncheck_item_for_coupon=function(f,g){var h;h=$.ajax({type:"GET",url:"uncheck_item",cache:false,data:{item_id:f},dataType:"json"});return h.then(function(i){if(i.code===0){return cart.show({couponShopIds:g})}},function(i){return alert(cart.errorMessage.error_100)})};e.prototype.check_item_for_coupon=function(f,g){var h;h=$.ajax({type:"GET",url:"check_item",cache:false,data:{item_id:f},dataType:"json"});return h.then(function(i){if(i.code===0){return cart.show({couponShopIds:g})}},function(i){return alert(cart.errorMessage.error_100)})};e.prototype.uncheck_item=function(f){var g;g=$.ajax({type:"GET",url:"uncheck_item",cache:false,data:{item_id:f},dataType:"json"});return g.then(function(h){if(h.code===0){var i={couponNotRefresh:true};return cart.show(i)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.check_item=function(f){var g;g=$.ajax({type:"GET",url:"check_item",cache:false,data:{item_id:f},dataType:"json"});return g.then(function(h){if(h.code===0){var i={couponNotRefresh:true};return cart.show(i)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.uncheck_point=function(f){var g;g=$.ajax({type:"GET",url:"uncheck_point",cache:false,data:{itemId:f},dataType:"json"});return g.then(function(h){if(h.code===0){var i={couponNotRefresh:true};return cart.show(i)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.check_point=function(g){var f;f={itemId:g,};clearTimeout(this.countTimer);return this.countTimer=setTimeout(function(){var h;h=$.ajax({type:"GET",url:"check_point",cache:false,data:{itemId:g},dataType:"json"});return h.then(function(i){if(i.code===-3){return false}if(i.code===0){}else{f.reason="checkPointResultInfo";f.errorMsg=i.body["msg"];f.itemId=i.body["itemId"];f.errorCode=i.code}f.couponNotRefresh=true;return cart.show(f)},function(i){return alert(cart.errorMessage.error_100)})},200)};e.prototype.uncheck_all=function(){var f;f=$.ajax({type:"GET",url:"uncheck_all",cache:false,dataType:"json"});return f.then(function(g){if(g.code===0){var h={couponNotRefresh:true};return cart.show(h)}},function(g){return alert(cart.errorMessage.error_100)})};e.prototype.check_all=function(){var f;f=$.ajax({type:"GET",url:"check_all",cache:false,dataType:"json"});return f.then(function(g){if(g.code===0){var h={couponNotRefresh:true};return cart.show(h)}},function(g){return alert(cart.errorMessage.error_100)})};e.prototype.choice_promotion=function(h,g){var f;f={itemId:h,};clearTimeout(this.countTimer);return this.countTimer=setTimeout(function(){var i;i=$.ajax({type:"GET",url:"choice_promotion",cache:false,data:{itemId:h,promotionId:g},dataType:"json"});return i.then(function(j){if(j.code===-3){return false}if(j.code===0){}else{f.reason="choicePromotion";f.errorMsg=j.body["msg"];f.itemId=j.body["itemId"];f.errorCode=j.code}f.couponNotRefresh=true;return cart.show(f)},function(j){return alert(cart.errorMessage.error_100)})},200)};e.prototype.showImip=function(f){var h,g;h={shop_id:f};g={entrance_code:"pc_cart_home",position_code:"main"};return showImDialog(g,h)};e.prototype.imipMergeCart=function(f){return $.ajax({type:"GET",url:"mergeCart",cache:false,success:function(g){if(0===g.code){$("#LoginFalse").hide();NAMESPACE_CART.isLogin=true;$("#LoginFalse").css("display","none");cart.show();return cart.showImip(f)}}})};e.prototype.imipOnlineCheck=function(){var f;f=$(".fn-imip");return $.each(f,function(i,h){var k,g,j;j=$(h).data("item");k={entrance_code:"pc_cart_home",shop_id:j,fields:"is_valid"};g={shopId:j};return getMerchantGroupInfo(k,function(m,l){return cart.imipStatusChange(m.is_valid,l.shopId)},g)})};e.prototype.imipStatusChange=function(f,i){var g,h;g=$(".fn-imip[data-item='"+i+"']");h=g.find("img");if("true"===f||f){return h.attr("src","images/icon_cse.gif")}else{return h.attr("src","images/icon_cse_off.gif")}};e.prototype.showTip=function(m,r,q){var i,s,k,u,n,l,p,g,j,o,f,h,t;i=0;o=0;s=0;if(m){u=m.offset();n=u.left;l=u.top;p=m.outerWidth();k=m.outerHeight()}j=r.outerWidth();g=r.outerHeight();f=$(window).height();h=$(window).width();t=$(window).scrollTop();switch(q){case 1:i=n+p;o=l;s="";break;case 2:i=n-(j-p)/2;o=l-g;s="";break;case 3:i=n-(j-p)/2;o=l+k;s="";break;case 4:i="";o=l-g;s=0;break;default:i=t+(h-j)/2;o=(f-g)/2;break}return r.css({left:i,right:s,top:o}).show()};e.prototype.remove_product=function(f){var i;var h="";try{h=DDT.__rpms_line}catch(g){}i=$.ajax({type:"POST",url:"remove",cache:false,data:{itemIds:f,page_tracing:h,referer:window.location.href},dataType:"json"});return i.then(function(j){if(j.code===0){cart.show()}if(j.code===-100){return alert(cart.errorMessage.error_203)}},function(j){return alert(cart.errorMessage.error_100)})};e.prototype.addToWish=function(f){var g;g=$.ajax({type:"POST",url:"add_wish_new",cache:false,data:{products:f.products},dataType:"json"});return g.then(function(h){if(h.code===-3){return false}var i;if(h.code===0){cart.show()}if(h.code===-1||h.code===2){alert(cart.errorMessage.error_202)}if(h.code===3){i=$("#J_errorBox");i.find("p").html("您已收藏的商品已达到收藏上限，不可以加入收藏了。");if(f.target){return cart.showTip(f.target,i,2)}else{return cart.showTip(f.target,i,"")}}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.mergeWish=function(f){var g;g=$.ajax({type:"GET",url:"mergeCart",cache:false});return g.then(function(h){if(h.code===0){$("#LoginFalse").hide();$("#remove_pop").hide();return cart.addToWish(f)}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.closeTipBox=function(f){return $(f).parent('[id ^= "J"]').hide()};e.prototype.changeGift=function(f){var h,j,i,g;g="";h="";i=f.target;if("chooseGift"===f.from){g="addGift"}else{g="removeGift"}if("chooseGift"===f.from){h={giftId:f.giftId,cartItemId:f.cartItemId,promtionId:f.promotionId,shopId:f.shopId}}else{h={itemGiftId:f.itemGiftId}}j=$.ajax({type:"GET",url:g,cache:false,data:h,dataType:"json"});return j.then(function(k){if(k.code===-3){return false}if(k.code===0){$("#mask").hide();$("#sema").hide().data("info",void 0);return cart.show()}else{if(k.code===113){i.addClass("unable");return i.append('<div class="un_mask"></div><div class="un_tip">库存不足</div>')}else{i.addClass("unable");return i.append('<div class="un_mask"></div><div class="un_tip">缺货</div>')}}},function(k){return alert(cart.errorMessage.error_100)})};e.prototype.addGift=function(g,h){var i,f;f="addGift";i=$.ajax({type:"GET",url:f,cache:false,data:g,dataType:"json"});return i.then(function(j){if(j.code===-3){return false}if(j.code===0){h.parent().parent().find("ul li a span").removeClass("choosen");return h.find("a span").addClass("choosen")}else{if(j.code===113){return h.append('<div class="un_mask"></div><div class="un_tip">库存不足</div>')}else{return h.append('<div class="un_mask"></div><div class="un_tip">缺货</div>')}}},function(j){return alert(cart.errorMessage.error_100)})};e.prototype.changeProductCountTips=function(f){var g,h;g={errorMsg:"",alertMsg:"",changeCount:f.newCount,itemId:f.itemId};if(f){h=f.itemId;if(100===f.errorCode){g.errorMsg='<span class="fn-err-msg red">缺货</span>';g.changeCount=f.oldCount}else{if(143===f.errorCode){g.errorMsg='<span class="fn-err-msg red">库存紧张</span>';g.changeCount=f.oldCount}else{if(121===f.errorCode){g.changeCount=f.oldCount}else{if(124===f.errorCode){if(f.oldCount<10000){g.errorMsg='<span class="fn-err-msg red">限购'+f.oldCount+"件</span>";g.changeCount=f.oldCount}}else{if(128===f.errorCode){g.alertMsg="同一商品的不同色码或规格共限购"+f.oldCount+"件";g.errorMsg='<span class="fn-err-msg red">超过限购数量</span>';g.changeCount=f.oldCount}else{if(144===f.errorCode){g.errorMsg='<span class="fn-err-msg red">超出限购数量</span>';g.changeCount=f.oldCount}else{if(433===f.errorCode){g.errorMsg='<span class="fn-err-msg red">该套餐限购'+f.oldCount+"套</span>";g.changeCount=f.oldCount}}}}}}}}return g};e.prototype.checkout=function(){return cart.checkOrder()};e.prototype.unCheckUserCart=function(){NAMESPACE_CART.isLogin=true;var f;f=$.ajax({type:"GET",url:"uncheck_all",cache:false});return f.then(function(g){if(g.code===0){$("#LoginFalse").hide();return cart.mergeAndCheckOrder()}},function(g){return location.reload()})};e.prototype.mergeAndCheckOrder=function(g){var h,f;f="mergeCart";if(g){f="mergeCart?breakSpecialPromo=true"}h=$.ajax({type:"GET",url:f,cache:false});return h.then(function(i){if(i.code===0){return cart.checkOrder()}},function(i){return location.reload()})};e.prototype.myEncode=function(){var g,f;f=window.location.href;g=f.indexOf("#");if(g>0){f=f.substring(0,g)}else{g=f.indexOf("dd_refer=");if(g>0){f=f.substring(0,g-1)}}return encodeURIComponent(f)};e.prototype.loginToWish=function(g,h){var f;f={products:g,target:$(".fn-add-wish[data-cartitemid="+h+"]")};if(false===NAMESPACE_CART.isLogin){return showMsgBox("wish","","",this.mergeWish,f,this,"shopping")}else{return cart.addToWish(f)}};e.prototype.loginBatchToWish=function(g){var f;f={products:g};if(false===NAMESPACE_CART.isLogin){return showMsgBox("wish","","",this.mergeWish,f,this,"shopping")}else{$("#remove_pop").hide();return cart.addToWish(f)}};e.prototype.checkOrder=function(){var g,f;f=$(".fn-checkout");g=$.ajax({type:"GET",url:"check_order",cache:false,dataType:"json"});return g.then(function(aR){if(aR&&aR.code===-3){return false}var ab,S,aH,Y,z,W,V,aO,aJ,au,aa,r,aM,B,aQ,U,ay,ax,aB,T,aN,G,H,u,R,aj,Q,ag,ae,ad,P,I,O,N,M,aA,Z,aZ,aW,L,K,X,ap;z=aR.body["url"];X=[],ap=[];if(!aR){return false}if(aR.code===-2){if(NAMESPACE_CART.isLogin){showMsgBox("","","",cart.checkOrder,"","","shopping")}else{showMsgBox("","","",cart.unCheckUserCart,"","","shopping")}return}if(!NAMESPACE_CART.isLogin){cart.unCheckUserCart();return}if(aR.code===0){return window.location.href=z+"#dd_refer="+cart.myEncode()}else{$("#spuPromoLimitDiv").hide();$("stockShortDibv").hide();if(((Z=aR.body["prods"])!=null?Z.length:void 0)>0){U;M=[];R=0;W=[];L=[];Y=0;aH=aR.body["prods"];var aY=new Array();var af=new Array(),aX=new Array(),v=new Array();for(Q=0,ag=aH.length;Q<ag;Q++){I=aH[Q];r=I.message;aa=I.code;if(2===aa){alert(r);return}else{if(828===aa){r=aR.body.prods[0].message;aJ=r.split(";").length;$("#ck_tip").find("p").text("您购物车中重复购买了"+aJ+"件电子书（"+r+"），现只为您保留了一本电子书，其余删除，祝您购物愉快！");$("#ck_link").attr("href",z+"#dd_refer="+cart.myEncode());$("#ck_tip").show();return}}try{if(433!==aa&&2!==aa){G=I.body["itemId"];if(G==undefined){G=I.body["cartItemId"]}S=$("#tr_"+G);U=S.offset().top;M[R]=U}}catch(au){V=au;console.log(V)}if(433===aa){H=I.body["cartItemIds"];if((H!=null?H.length:void 0)>0){H.sort(function(h,i){return parseFloat(h)-parseFloat(i)})}u=H.join(",");ab=$('[data-item = "'+u+'"]').parent().parent();if(ab.find(".fn-count-tip .fn-err-msg").length===0){ab.find(".fn-count-tip").append('<span class="fn-err-msg red">'+r+"</span>");ay=ab.offset().top;$(window).scrollTop(ay);return false}}else{if(128===aa){var aD=new spuErrorInfoRecord(I.body["productId"],I.body["productName"],I.body["mainProductId"],I.body["buyNum"],I.body["cartItemId"],I.body["maxBuyNum"]);aY.push(aD);var ak=false;for(var aw=0;aw<af.length;aw++){if(af[aw]==I.body["mainProductId"]){ak=true;v[aw]=parseInt(v[aw])+parseInt(I.body["buyNum"])}}if(ak==false){af.push(I.body["mainProductId"]);aX.push(I.body["maxBuyNum"]);v.push(I.body["buyNum"])}}else{I.body["errorCode"]=aa;if(100===aa||114===aa||113===aa){ap.push(I.body)}else{if(143===aa||117===aa||115===aa){X.push(I.body)}}}}W[R]=G;L[R]=G;R++}if(0!==ap.length||0!==X.length){var A={};var aU={};var aV=[];var y=[];for(T=0;T<X.length;T++){var aF=X[T];if(aF.giftId){var ac=A[aF.productId];if(!ac){A[aF.productId]=aF;aV.push(aF)}else{ac.giftId=ac.giftId+","+aF.giftId;ac.stock=ac.stock+aF.stock;ac.count=ac.count+aF.count}}else{aV.push(aF)}}for(T=0;T<ap.length;T++){var aF=ap[T];if(aF.giftId){var ac=aU[aF.productId];if(!ac){aU[aF.productId]=aF;y.push(aF)}else{ac.giftId=ac.giftId+","+aF.giftId;ac.stock=ac.stock+aF.stock;ac.count=ac.count+aF.count}}else{y.push(aF)}}var F="";for(T=0;T<aV.length;T++){var aF=aV[T];var J=aF.itemId;var aP=aF.giftId;var ao=aF.productName;var al=aF.count;var av=aF.stock;var aT=aF.targetCount;var at=aF.batchId;var C="http://product.dangdang.com/"+aF.productId+".html";var E=cart.getProductImgUrlWithVersion(aF.mainProductId,aF.productId,aF.numImages,aF.imgVersion,"b");var aE="";var D="";if(aP){if(aF.errorCode==115){aE='<span class="icon icon_b">赠品</span>'}else{if(aF.errorCode==117){aE='<span class="icon icon_b blue">加价购</span>'}}}else{if(at){D='<span class="icon icon_b green">套餐</span>'}}var aG="data-item-id="+J+" data-gift-id="+aP+" data-count="+al+" data-stock="+aT+" data-batch-id="+at;F+="<li "+aG+'><div class="img"><a href="'+C+'"><img src="'+E+'" width="80" height="80">'+(aE||D)+'</a></div><p class="name"><a href="'+C+'">'+ao+'</a></p><p>可购买数量：<span class="red">'+av+"</span></p><p>订购数量："+al+"</p></li>"}for(T=0;T<y.length;T++){var aF=y[T];var J=aF.itemId;var aP=aF.giftId;var ao=aF.productName;var al=aF.count;var av=aF.stock;var aT=aF.targetCount;var at=aF.batchId;var C="http://product.dangdang.com/"+aF.productId+".html";var E=cart.getProductImgUrlWithVersion(aF.mainProductId,aF.productId,aF.numImages,aF.imgVersion,"b");var aE="";var D="";if(aP){if(aF.errorCode==113){aE='<span class="icon icon_b">赠品</span>'}else{if(aF.errorCode==114){aE='<span class="icon icon_b blue">加价购</span>'}}}else{if(at){D='<span class="icon icon_b green">套餐</span>'}}var aG="data-item-id="+J+" data-gift-id="+aP+" data-count="+al+" data-stock="+aT+" data-batch-id="+at;F+="<li "+aG+'><div class="img"><a href="'+C+'"><img src="'+E+'" width="80" height="80"><span class="icon">售罄</span>'+(aE||D)+'</a></div><p class="name"><a href="'+C+'">'+ao+'</a></p><p>可购买数量：<span class="red">0</span></p><p>订购数量：'+al+"</p></li>"}$("#stockShortDiv .out_list").empty();$("#stockShortDiv .out_list").append(F);$("#stockShortDiv").show();return false}if(0!==M.length){for(T=P=0,aZ=M.length;0<=aZ?P<aZ:P>aZ;T=0<=aZ?++P:--P){if(M[T]>M[T+1]){W[T]=W[T+1];W[T+1]=W[T]}}ax=W[W.length-1];ay=$("#tr_"+ax).offset().top;$(window).scrollTop(ay);if(aY.length>0){var ah="";for(var az=0;az<af.length;az++){ah+='<div class="tips_row"><span class="icon_tip_s"></span>以下同一商品的不同色码或规格共限购<span class="red"> '+aX[az]+" </span>件，请返回购物车修改数量</div>";ah+='<dl class="goods_lists"><dt>';for(var t=0;t<aY.length;t++){if(aY[t]["mainId"]==af[az]){var aC="";$("#tr_"+aY[t]["cartItemId"]).find("div[class=swatchsize]").each(function(){$(this).find("em").each(function(){aC+=" "+$(this).html()})});ah+='<div class="goods"><div class="name">';ah+="<p>"+aY[t]["productName"]+"</p><p>"+$.trim(aC)+"</p></div>";ah+='<div class="num">购买数量：'+aY[t]["buyNum"]+"</div></div>"}}ah+='</dt><dd class="num_l">限购数量<b class="red">'+aX[az]+"</b></dd>";ah+="</dl>"}$("#spuPromoLimitDiv").find("div[class=popup_limit]").html(ah);$("#spuPromoLimitDiv").show()}}return false}if(aR.body["comm"]){$("#J_errorBox").find("p").html("<font style='line-height:14px;'>"+aR.body["comm"]+"</font>");cart.showTip(f,$("#J_errorBox"),2);return false}if(aR.body["shops"]){aO=aR.body["shops"];aB="";for(aj in aO){K=aO[aj];aB+=d.renderGiftShopTitle(aj)+d.shopSplitBegin();for(O=0,ae=K.length;O<ae;O++){aA=K[O];aB+=d.renderGiftMain(aA.body.productName,aA.body.giftProducts.length)+d.giftSplitBegin(aA.body.giftProducts.length);aN=0;aW=aA.body.giftProducts;for(N=0,ad=aW.length;N<ad;N++){aQ=aW[N];aN++;B=aQ.name;aM=aQ.id;if(aN===1){aB+=d.giftUlBegin(true)}else{if(aN%5===1){aB+=d.giftUlBegin(false)}}aB+=d.renderGiftInfo(aM,B,aQ.imgVersion||0,aA.body.cartItemId,aA.body.promotionId);if(aN%5===0||aN===aA.body.giftProducts.length){aB+=d.giftUlEnd()}}aB+=d.giftSplitEnd()}aB+=d.shopSplitEnd();$("#giftArea").html(aB);$("#gift_checkout").attr("href",z+"#dd_refer="+cart.myEncode())}return $("#giftDiv").show()}if(aR.body["pointFavorProduct"]&&((Z=aR.body["pointFavorProduct"]["usePointFavorProductInfoList"])!=null?Z.length:void 0)>0){$("#allNeedPointNum").html(aR.body["pointFavorProduct"]["allNeedPointNum"]);$("#userHasPointNum").html(aR.body["pointFavorProduct"]["userHasPointNum"]);var q,aL,am="";for(q in Z){aL=Z[q];var G=aL.itemId;var k=aL.productId,aK=aL.mainProductId;var an=aL.productName,ar=aL.salePrice;var aS=parseInt(aL.limitBuyNum),w=aL.pointNum;var x=aL.count,aI=aL.numImages;var aq=aL.imgVersion,ai=aL.overlayStrategy;am+='<div class="item" data-itemid="'+G+'">';am+='<a href="'+(cart.getProductUrl(k))+'" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;"><img src="'+(cart.getProductImgUrlWithVersion(aK,k,aI,aq||0,"b"))+'"></a>';am+='<div class="product_info">';am+='<p class="name">';am+='<a href="'+(cart.getProductUrl(k))+'" title="'+an+'" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;">'+an+"</a>";am+='</p></p><p class="remind_tips">';if(aS>0&&aS<10000){am+="银铃铛购限购"+aS+"件";if(ai!=null&&ai!=""&&ai!="can_not_buy"){am+="，超出部分将以"+ar+"元/件结算"}}am+="</p>";am+='<div class="num_change"><span class="remnd_red">需<lable class="item_need_point_num">'+parseInt(w)*parseInt(x)+'</lable>银铃铛</span><div class="change_num" data-count="'+x+'" data-limitbuynum="'+aS+'" data-pointnum="'+w+'" data-saleprice="'+ar+'" data-overlaystrategy="'+ai+'"><span class="a">-</span><input data-original="'+x+'" data-current="'+x+'" value="'+x+'" class="countInput" /><span class="a">+</span></div></div>';am+="</div></div>"}$("#usePointFavorProductInfoList").html(am);$("#pointFavorErrorPageForCheckOut").show();return false}}},function(h){return alert(cart.errorMessage.error_100)})};e.prototype.getExchangeGifts=function(g,h){var f=[];$.ajax({type:"GET",url:"exchangeGiftList",cache:false,data:{itemId:g},dataType:"json",success:function(j){if(j.code===0){var m=j.body;if(m!=null&&m.length>0){for(var l=0;l<m.length;l++){var k=m[l].promotionType;if(d.isProductExchange(k)){f=m[l]}}}}h(f)},error:function(i){alert("error=\n"+i);h(f)}})};e.prototype.getGiftHtmlBlock=function(g,f){f.isJustGiftHtmlBlockl=true;return cart.html_temps.div_gift(g,f)};e.prototype.checkPointFavorDialog=function(l,p,m){var f=parseInt(l.parent().data("pointnum"));var h=parseInt(l.parent().data("limitbuynum"));var k=l.parent().data("overlaystrategy");var g=l.parent().data("saleprice");var o=parseInt($("#userHasPointNum").html());if(p>=0){var q,n="",j=false;if(h!=0&&p>h){if(k!=null&&k!=""&&k=="can_not_buy"){n="银铃铛购限购"+h+"件";p=h}else{n="银铃铛购限购"+h+"件，超出部分将以"+g+"元/件结算"}j=true;q=f*h}else{if(p==0){j=true;n="点击确认后，该商品将被删除"}q=f*p}if(q>o&&p>m){n="可用银铃铛不足";j=true;p=m}l.parent().find(".countInput").val(p);l.parent().find(".countInput").data("current",p);l.parent().parent().find(".item_need_point_num").html(f*p);if(n==""&&h!=0&&h<10000){n="银铃铛购限购"+h+"件"}l.parent().parent().parent().find(".remind_tips").html(n);if(j==true){l.parent().parent().parent().find(".remind_tips").hide();l.parent().parent().parent().find(".remind_tips").show("slow")}var i=0;$("#pointFavorErrorPageForCheckOut").find(".item_need_point_num").each(function(){i+=parseInt($(this).html())});$("#allNeedPointNum").html(i)}else{}};return e})();$(function(){var m,g,q,s,h,i,p,f,r,n,l,j,k;h=$("#cart");p=$("#mask");n=$("#sema");g=$(".shopping_total");r=$("#J_removeProductBox");m=$("#J_addWishBox");i=$("#J_errorBox");s=$("#J_batchRemoveProductBox");q=$("#J_batchAddWishBox");f=$("#J_removeGiftBox");j=void 0;$(window).bind("scroll",function(){var x,w,v,u,t;u=$(".shopping_total").offset().top;w=$("#hide_div").offset().top;v=$(document).scrollTop();t=$(window).height();x=$(".shopping_total").parent();if((u-0)-(w-0)<=20){if(parseFloat(v)+parseFloat(t)<parseFloat(u)){return x.css("position","fixed")}}else{if(parseFloat(u)>=parseFloat(w)){return x.css("position","static")}}});$("#showTip").on("mouseover",".fn-show-tip",function(){var t;t=$(this).data("item");return $(".pop_tip[data-item='"+t+"']").toggle()}).on("click",".fn-wish-tip",function(){var t=$(this).data("item-detail");t=JSON.stringify(t);return l.loginBatchToWish(t)}).on("click",".fn-remove-tip",function(){var t;t=$(this).data("item");t=t.substr(0,t.length-1);l.remove_product(t);return $("#remove_pop").hide()}).on("click",".fn-clear-tip",function(){var t;t=$(this).data("item");t=t.substr(0,t.length-1);l.remove_product(t);$("#clear_pop").hide();return $("#fn-clear-a").hide()});$(".shopping_total_left").on("click",".fn-clear-tip",function(){var t;t=$(this).data("item");t=t.substr(0,t.length-1);l.remove_product(t);$("#clear_pop").hide();$("#fn-clear-a").hide();return $(this).css("display","none")});f.on("click",".fn-confirm-removegiftbox",function(){var w,u,t,v;f.hide();v=f.attr("target");u=f.attr("itemGiftId");w=f.attr("from");t={target:v,itemGiftId:u,from:w};return l.changeGift(t)}).on("click",".fn-close-removebox",function(){return l.closeTipBox($(this))});r.on("click",".fn-confirm-removebox",function(){var t;r.hide();t=r.attr("itemId");return l.remove_product(t)}).on("click",".fn-close-removebox",function(){return l.closeTipBox($(this))});i.on("click",".fn-close-removebox",function(){return l.closeTipBox($(this))});s.on("click",".fn-confirm-batchremovebox",function(){var t;s.hide();t=s.attr("itemId");return l.remove_product(t)}).on("click",".fn-close-batchremovebox",function(){return l.closeTipBox($(this))});q.on("click",".fn-confirm-batchaddwish",function(){var t;q.hide();t=q.attr("itemId");return l.loginBatchToWish(t)}).on("click",".fn-close-batchwishbox",function(){return l.closeTipBox($(this))});m.on("click",".fn-confirm-addwish",function(){var t=m.attr("itemId");m.hide();wishProductArray=m.attr("wishProductArray");return l.loginToWish(wishProductArray,t)}).on("click",".fn-close-wishbox",function(){return l.closeTipBox($(this))});i.on("click",".fn-confirm-errorbox",function(){return l.closeTipBox($(this))});$("#weipinboxarea").on("mouseover",".fn-vnewz-tips",function(){var t;t=$("#J_vnewzTipBox");return l.showTip($(this),t,2)}).on("mouseout",".fn-vnewz-tips",function(){var t;t=$("#J_vnewzTipBox");return t.hide()});function e(w,u){var z,D,F,x,C,y,t,B,A,I,H,v;if(w==null){w=[]}z="";D="";if(categoryid==1){D="<ul class='add_tab'><li><a href='javascript:;' class='current' data-categoryid='2'>日百</a></li><li class='current'><a href='javascript:;' class='current' data-categoryid='1'>图书</a></li><li><a href='javascript:;' class='current' data-categoryid='3'>文具</a></li></ul>"}else{if(categoryid==2){D="<ul class='add_tab'><li class='current'><a href='javascript:;' class='current' data-categoryid='2'>日百</a></li><li><a href='javascript:;' class='current' data-categoryid='1'>图书</a></li><li><a href='javascript:;' class='current' data-categoryid='3'>文具</a></li></ul>"}else{D="<ul class='add_tab'><li><a href='javascript:;' class='current' data-categoryid='2'>日百</a></li><li><a href='javascript:;' class='current' data-categoryid='1'>图书</a></li><li class='current'><a href='javascript:;' class='current' data-categoryid='3'>文具</a></li></ul>"}}C="<div class='add_box'>";B=1;I=w.length;H=8;countCurrentPage=H;if(I==0){y="<div class='none_box'><img src='images/empty.png' width='235' height='180' /><p>没有找到您喜欢的商品，您可以<a href='http://www.dangdang.com' class='btn_red'>再逛逛</a></p></div>";return z+D+C+y+"</div>"}v=Math.ceil(I/H);x="";t="<div class='show_list'><a href='javascript:;' class='arrow_shipping'></a><a href='javascript:;' class='arrow_shipping right'></a>";F="";for(B=0;B<v;B++){if(B==0){F=F+"<ul class='show_box' style='display:block;'>"}else{F=F+"<ul class='show_box' style='display:none;'>"}var E="";if(B==v-1){countCurrentPage=I-(v-1)*H}for(A=0;A<countCurrentPage;A++){var G=w[B*H+A];E=E+"<li request_id='"+u+"'><a href='"+l.getProductUrl(G.productId)+"#ddclick_reco_free_delivery' class='img' title='"+G.productName+"'><img src='"+l.getProductImgUrlWithVersion(0,G.productId,0,G.imgVersion,"p")+"' width='90' height='90' /></a><p><a href='"+l.getProductUrl(G.productId)+"#ddclick_reco_free_delivery' class='name'>"+G.productName+"</a></p><p><span class='price'>¥"+(parseFloat(G.bargainPrice)/100).toFixed(2)+"</span></p><p><a href='javascript:;' data-item='"+G.productId+"' class='btn_red'>加入购物车</a></p></li>"}F=F+E+"</ul>";if(B==0){x=x+"<li class='on'>"+(B+1)+"</li>"}else{x=x+"<li>"+(B+1)+"</li>"}}t=t+F+"<ul class='add_num'>"+x+"</ul>";return z+D+C+t+"</div>"}function o(){$("#choose_shop_gift").click(function(){alert("11111")})}g.on("click",".fn-checkall",function(){var t,u;u=$(this);t=u.hasClass("check_on");if(t){u.removeClass("check_on");$("#cart .fn-checkall").removeClass("check_on");return l.uncheck_all()}else{u.addClass("check_on");$("#cart .fn-checkall").addClass("check_on");return l.check_all()}}).on("click",".fn-batch-remove",function(){var t;t=$(".fn-product-check.check_on").map(function(){return $(this).data("item")}).toArray().join(",");s.attr({itemId:t});return s.show()}).on("click",".fn-batch-wish",function(){var t;t=$(".fn-product-check.check_on").map(function(){return $(this).data("item")}).toArray().join(",");q.attr({itemId:t});return q.show()}).on("click",".fn-checkout",function(){if($(this).hasClass("unable")){return false}return l.checkout()});h.on("click",".fn-switchsize",function(){k({pid:$(this).data("pid"),name:$(this).data("name"),itemId:$(this).data("item"),mainProductId:$(this).data("mainproductid"),numImages:$(this).data("numimages")});return false}).on("click",".fn-modify-gift",function(){k({pid:$(this).data("pid"),name:$(this).data("name"),itemId:$(this).data("item"),isGift:true,target:"",cartItemId:$(this).data("item"),promotionId:$(this).data("promotionid"),from:"chooseGift"})}).on("click",".shipping_tip a",function(){var z,y,w,A,v,t,u,x;z=$(this);y=z.parentsUntil("#J_cartContent").find(".shipping_add");if(z.hasClass("more up")){z.removeClass("more up").addClass("more");y.toggle();return false}if(shippingData!=null){y.children().remove();y.append(e(shippingData[categoryid]["body"]["products"],shippingData[categoryid]["body"]["requestId"]));z.removeClass("more").addClass("more up");y.toggle();return true}w=$(this).data("categoryid");A=$(this).data("pids");v=$(this).data("stockids");t=$(this).data("topprice");u=$(this).data("pricediff");x=$(this).data("totalprice");y.children().remove();$.ajax({type:"GET",url:"list_shipping",cache:false,data:{mediumScopeid:w,pids:A},dataType:"json",success:function(B){if(B&&B.code===-3){return false}if(0!==B.code){y.append(e([],""));z.removeClass("more").addClass("more up");y.toggle()}else{var C=B.body||{};shippingData=C;y.append(e(shippingData[categoryid]["body"]["products"],shippingData[categoryid]["body"]["requestId"]));z.removeClass("more").addClass("more up");y.toggle()}},error:function(){y.append(e([],""));z.removeClass("more").addClass("more up");y.toggle()}})}).on("click",".shipping_add > ul > li > a",function(){var t;categoryid=$(this).data("categoryid");t=$(this).parentsUntil("#J_cartContent").find(".shipping_add");t.children().remove();if(shippingData!=null){t.append(e(shippingData[categoryid]["body"]["products"],shippingData[categoryid]["body"]["requestId"]))}else{t.append(e([],""))}}).on("click",".shipping_add > .add_box > .show_list > a",function(){var x,v,u,t,w;x=$(this);$ul_page=x.parent().parent().find(".add_num");t=0;u=0;$ul_page.find("li").each(function(){t++;if($(this).hasClass("on")){u=t}});if(x.hasClass("right")){u=(u+1)>t?1:u+1}else{u=(u-1)<1?t:u-1}$ul_page.find("li").removeClass("on").eq(u-1).addClass("on");$ul_page.parent().find(".show_box").hide().eq(u-1).show();return false}).on("click",".shipping_add > .add_box > .show_list > .add_num > li",function(){idx=$(this).text();$(this).parent().find("li").removeClass("on").eq(idx-1).addClass("on");$(this).parent().parent().find(".show_box").hide().eq(idx-1).show()}).on("click",".shipping_add .show_box .btn_red",function(){var v,A,y,B,u,z,w;y=$(this);u=$(this).data("item");B=$("#J_errorBox");w=$('.btn_red[data-item = "'+u+'"]');z=w.data("item");var t="";try{t=DDT.__rpms_line}catch(x){}return $.ajax({type:"POST",url:"shopping_cart_add",cache:false,data:{invoke_type:1,product_ids:z,page_tracing:t,referer:window.location.href},dataType:"json",success:function(C){if(C&&C.code===-3){return false}if(0!==C.code&&w){if(100===C.code||102===C.code||228===C.code){y.parent().parent().append("<div class='mask'></div><p class='ok sorry'>抱歉，卖完了</p>")}else{y.parent().parent().append("<div class='mask'></div><p class='ok sorry'>抱歉，加入购物车失败</p>")}setTimeout(function(){y.parent().parent().find(".mask").remove();y.parent().parent().find(".ok").remove()},1000)}else{y.parent().parent().append("<div class='mask'></div><p class='ok'>恭喜，已添加至购物车</p>");firstShipping=1;l.show();setTimeout(function(){if(firstShipping==1){firstShipping=0;$(".shipping_tip a").parentsUntil("#J_cartContent").find(".shipping_add").append(e(shippingData[categoryid]["body"]["products"],shippingData[categoryid]["body"]["requestId"]));$(".shipping_tip a").removeClass("more up").addClass("more");$(".shipping_tip a").parentsUntil("#J_cartContent").find(".shipping_add").toggle()}},1000)}},error:function(){y.parent().parent().append("<div class='mask'></div><p class='ok sorry'>抱歉，加入购物车失败</p>");setTimeout(function(){y.parent().parent().find(".mask").remove();y.parent().parent().find(".ok").remove()},1000)}})}).on("click",".fn-ebook-checkout",function(){if(NAMESPACE_CART.isLogin){return window.location.href="http://e.dangdang.com/media/api2.go?action=toEbookOrder"}else{showMsgBox("","","",l.mergeLogin,"","","shopping");return false}}).on("click",".fn-imip",function(){var t;t=$(this).data("item");if($(this).find("img").attr("src")==="images/icon_cse_off.gif"){return}if(NAMESPACE_CART.isLogin){return l.showImip(t)}else{return showMsgBox("","","",l.imipMergeCart,t,"","shopping")}}).on("click",".ebtn",function(){return console.log("打开关闭赠品选择")}).on("click",".fn-remove-gift",function(){f.attr({target:$(this),itemGiftId:$(this).data("item"),from:"removeGift"});return l.showTip($(this),f,2)}).on("click",".ebtn",function(){return console.log("分页按钮123")}).on("click","xxxx",function(){return console.log("赠品点击选中")}).on("click","yyyy",function(){return console.log("赠品点击选中")}).on("click","xxxx",function(){return console.log("赠品点击选中")}).on("click",".fn-remove-product",function(){var t;t=r;t.attr({itemId:$(this).data("item")});return l.showTip($(this),t,2)}).on("click",".fn-add-wish",function(){var t;wishProduct=$(this).data("item-detail");wishProductArray=[];wishProductArray.push(wishProduct);t=$("#J_addWishBox");t.attr({wishProductArray:JSON.stringify(wishProductArray),itemId:wishProduct.cartItemId});return l.showTip($(this),t,2)}).on("click",".fn-updatecount>a",function(){var w,A,t,x,D,B,u,v,C,z,E,y;C=$(this);console.log("点击加减号");w=l.info.cartId;x=$(C.parent().find("a")[0]);t=$(C.parent().find("input")[0]);u=t.val()-0;B=t.val()-0;A=$(C.parentsUntil("tbody").find("td a")[0]).data("item");z=C.parent().parent().parent();v=z.find(".fn-count-tip");D="dec";y=v.data("minbuy");E=z.find("td:first a").data("item");if(C.hasClass("default")){return}if(C.text()==="+"){D="inc";B=u+1;x.removeClass("default")}else{if(u>=1){B=u-1;if(B===0){}else{if(B===y){x.addClass("default")}else{x.removeClass("default")}}}}if(B===0){r.attr({itemId:E});l.showTip($(this).parent().parent().parent().find(".fn-remove-product"),r,2)}else{t.val(B);l.updateCount({cartId:w,oldCount:u,newCount:B,cartItemId:A,from:D,trTarget:z,target:v})}$("#ck_tip").hide();return false}).on("click",".fn-special a",function(){var t,x,w,z,y,v,u;x=$(this);t=x.parent().find("input");w=t.parent().parent().parent();u=t.val()-0;v=u;z="dec";if(x.hasClass("default")){return}if(x.text()==="+"){v=u+1;z="inc";x.removeClass("default")}else{if(u>=1){v=u-1;if(v===0){}else{x.removeClass("default")}}}y=w.find("td:first a").data("item");if(v===0){r.attr({itemId:y});l.showTip(w.find(".fn-remove-product"),r,2)}else{x.val(v);l.changePackageCount({batchId:t.data("item"),oldCount:u,newCount:v,target:t,from:z,trTarget:w,itemId:y})}$("#ck_tip").hide();return false}).on("keypress",".fn-special input",function(x){var t,y,w,v,B,E,z,D,C,A,u;y=$(this);u=y.val();v=""+y.data("value");D=x.keyCode||x.which;A=y.data("value")-0;C=u-0;B="update_count";w=y.parent().parent().parent();t=y;E=/^\d+$/;if(D===13){if(!E.test(u)){y.val(1);C=1}y.data("value",u);z=w.find("td:first a").data("item");l.changePackageCount({batchId:t.data("item"),oldCount:A,newCount:C,target:t,from:B,trTarget:w,itemId:z})}else{if(D===8){}else{if(b.call([48,49,50,51,52,53,54,55,56,57],D)<0){return false}}}}).on("blur",".fn-special input",function(x){var t,y,w,v,B,E,z,D,C,A,u;y=$(this);u=y.val();v=""+y.data("value");D=x.keyCode||x.which;A=y.data("value")-0;C=u-0;B="update_count";w=y.parent().parent().parent();t=y;E=/^\d+$/;if(!E.test(u)){y.val(1);C=1}z=w.find("td:first a").data("item");return l.changePackageCount({batchId:t.data("item"),oldCount:A,newCount:C,target:t,from:B,trTarget:w,itemId:z})}).on("keypress",".fn-updatecount>input",function(D){var x,B,t,y,F,C,v,u,E,A,z,H,G,w;E=$(this);w=E.val();H=/^\d+$/;z=""+E.data("value");G=D.keyCode||D.which;x=l.info.cartId;y=$(E.parent().find("a")[0]);t=$(E.parent().find("input")[0]);v=E.data("value")-0;C=w-0;B=$(E.parentsUntil("tbody").find("td a")[0]).data("item");F="update_count";A=E.parent().parent().parent();u=A.find(".fn-count-tip");if(G===13){if(!H.test(w)){t.val(1);C=1}E.data("value",w);l.updateCount({cartId:x,oldCount:v,newCount:C,cartItemId:B,from:F,trTarget:A,target:u})}else{if(G===8){}else{if(b.call([48,49,50,51,52,53,54,55,56,57],G)<0){return false}}}}).on("blur",".fn-updatecount>input",function(C){var x,A,t,y,E,B,v,u,D,z,F,w;D=$(this);w=D.val();x=l.info.cartId;y=$(D.parent().find("a")[0]);t=$(D.parent().find("input")[0]);v=D.data("value")-0;B=w-0;A=$(D.parentsUntil("tbody").find("td a")[0]).data("item");E="update_count";z=D.parent().parent().parent();u=z.find(".fn-count-tip");F=/^\d+$/;if(!F.test(w)){t.val(1);B=1}return l.updateCount({cartId:x,oldCount:v,newCount:B,cartItemId:A,from:E,trTarget:z,target:u})}).on("click",".fn-checkall",function(){var v,x,u,t,w;v=$(this);w=v.data("timer");t=v.data("target");x=function(){return 1};u=v.hasClass("check_on");if(u){v.removeClass("check_on");$(".shopping_total_left .fn-checkall").removeClass("check_on");x=function(){return l.uncheck_all()}}else{v.addClass("check_on");$(".shopping_total_left .fn-checkall").addClass("check_on");x=function(){return l.check_all()}}if(w&&t===!u){clearTimeout(w);v.data({timer:0,target:0})}else{w=setTimeout(function(){v.data({timer:0,target:0});return x()},200);v.data({timer:w,target:u})}}).on("click",".fn-select-gift",function(){var v,u,t;v=$(this).parent();if(v.hasClass("unable")){return}u=v.data("item").split("_");if(u.length===4){u.push(null)}t={target:v,giftId:u[0],cartItemId:u[1],promotionId:u[2],shopId:u[4],from:"chooseGift"};if($(this).data("item")=="1"){k({pid:u[0],name:u[3],itemId:u[1],shopId:u[4],isGift:true,target:v,cartItemId:u[1],promotionId:u[2],from:"chooseGift"});return false}else{return l.changeGift(t)}}).on("mouseover",".fn-select-gift",function(){if($(this).data("item")=="1"){$(this).find(".fn-select-spu").show()}}).on("blur",".fn-select-gift",function(){if($(this).data("item")=="1"){$(this).find(".fn-select-spu").hide()}}).on("click",".fn-shop-checkall",function(){var u,x,z,t,w,v,y;x=$(this);y=x.data("timer");v=x.data("target");z=function(){return 1};w=x.hasClass("check_on");u=x.parentsUntil(".fn-shop").parent().find("a.fn-product-check,a.fn-shop-checkall");t=u.map(function(){return $(this).data("item")}).toArray().join(",");if(w){u.removeClass("check_on");z=function(){return l.uncheck_item(t)}}else{u.addClass("check_on");z=function(){return l.check_item(t)}}if(y&&v===!w){clearTimeout(y);x.data({timer:0,target:0})}else{y=setTimeout(function(){x.data({timer:0,target:0});return z()},200);x.data({timer:y,target:w})}}).on("click",".fn-product-check",function(){var u,A,C,E,B,v,D,w,y,x,z,t;C=$(this);t=C.data("timer");z=C.data("target");E=function(){return 1};v=C.hasClass("check_on");u=C.parentsUntil(".fn-shop").parent().find("a.fn-shop-checkall");D=C.data("item");if(v){u.removeClass("check_on");C.removeClass("check_on");E=function(){return l.uncheck_item(D)}}else{C.addClass("check_on");E=function(){return l.check_item(D)};B=true;A=C.parentsUntil(".fn-shop").parent().find("a.fn-product-check");for(w=0,y=A.length;w<y;w++){x=A[w];if(!$(x).hasClass("check_on")){B=false;break}}if(B){u.addClass("check_on")}}if(t&&z===!v){clearTimeout(t);C.data({timer:0,target:0})}else{t=setTimeout(function(){C.data({timer:0,target:0});return E()},200);C.data({timer:t,target:v})}}).on("click",".fn-product-check-for-coupon",function(){var v,B,D,G,C,w,E,F,x,z,y,A,u,t;D=$(this);u=D.data("timer");A=D.data("target");G=function(){return 1};w=D.hasClass("check_on");v=D.parentsUntil(".fn-shop").parent().find("a.fn-shop-checkall");E=D.data("item");F=","+D.data("current_groupinfo")+",";t=D.data("coupon_serial_num");$("#J_cartContent").find(".fn-product-check-for-coupon").each(function(){if($(this).data("coupon_serial_num")==t){if(F.indexOf(","+$(this).data("current_groupinfo")+",")==-1){F+=$(this).data("current_groupinfo")+","}}});F=F.substring(1,F.length-1);if(w){v.removeClass("check_on");D.removeClass("check_on");G=function(){return l.uncheck_item_for_coupon(E,F)}}else{D.addClass("check_on");G=function(){return l.check_item_for_coupon(E,F)};C=true;B=D.parentsUntil(".fn-shop").parent().find("a.fn-product-check");for(x=0,z=B.length;x<z;x++){y=B[x];if(!$(y).hasClass("check_on")){C=false;break}}if(C){v.addClass("check_on")}}if(u&&A===!w){clearTimeout(u);D.data({timer:0,target:0})}else{u=setTimeout(function(){D.data({timer:0,target:0});return G()},200);D.data({timer:u,target:w})}}).on("hover",".promote_select .hover_btn",function(u){if(u.type=="mouseenter"){$(this).find(".promote").addClass("on");var t=$(this).find(".cancel").attr("originalpromid");$(this).find(".select").each(function(){if($(this).parent().attr("promotionid")==t){$(this).addClass("on")}else{$(this).removeClass("on")}});$(this).find(".show_info").show()}else{$(this).find(".promote").removeClass("on");$(this).find(".show_info").hide()}}).on("click",".promote_select .hover_btn .show_info .item .select",function(){var t=$(this).parent().attr("promotionid");$(this).parent().parent().find(".select").each(function(){if($(this).parent().attr("promotionid")==t){$(this).addClass("on")}else{$(this).removeClass("on")}});$(this).parent().parent().find(".confirm").attr("currentpromid",t)}).on("click",".promote_select .hover_btn .btn_confirm .cancel",function(){var t=$(this).attr("originalpromid");$(this).parent().parent().find(".item").each(function(){if($(this).attr("promotionid")==t){$(this).find(".select").addClass("on")}else{$(this).find(".select").removeClass("on")}});$(this).parent().parent().parent().find(".promote").removeClass("on");$(this).parent().parent().parent().find(".show_info").hide()}).on("click",".promote_select .hover_btn .btn_confirm .confirm",function(){var y,A,z,B,u,v,w,x,t;y=$(this);t=y.data("timer");x=y.data("target");A=function(){return 1};z=y.attr("itemid");B=y.attr("currentpromid");A=function(){return l.choice_promotion(z,B)};if(t&&x===!ischeck){clearTimeout(t);y.data({timer:0,target:0})}else{t=setTimeout(function(){y.data({timer:0,target:0});return A()},200);y.data({timer:t,target:ischeck})}}).on("click",".fn-point-favor-check",function(){if(false===NAMESPACE_CART.isLogin){return showMsgBox("","","",l.mergeLogin,"","","shopping")}var z,B,u,A,v,w,x,y,t;z=$(this);t=z.data("timer");y=z.data("target");B=function(){return 1};u=z.hasClass("check_on");A=z.data("item");if(u){z.removeClass("check_on");B=function(){return l.uncheck_point(A)}}else{z.addClass("check_on");B=function(){return l.check_point(A)}}if(t&&y===!u){clearTimeout(t);z.data({timer:0,target:0})}else{t=setTimeout(function(){z.data({timer:0,target:0});return B()},200);z.data({timer:t,target:u})}}).on("click",".fn-toggle-gift",function(){return $(this).parentsUntil("tr").find(".event_list").toggle()}).on("click",".fn-toggle-exchange-gift",function(){var t=this;var u=$(this).attr("itemId");l.getExchangeGifts(u,function(x){var w={itemId:u};var v=l.getGiftHtmlBlock(x,w);$(t).parent().parent().children(".event_list").children(".pages").remove();$(t).parent().parent().children(".event_list").append(v);$(t).removeClass();$(t).addClass("ebtn eblue fn-toggle-gift");$(t).parentsUntil("tr").find(".event_list").toggle()})}).on("click",".fn-pages > a",function(){var u,t;u=$(this);t=u.index();u.addClass("on").siblings().removeClass("on");u.parent().parent().children("ul").hide().eq(t).show();return false}).on("click",".fn-virtual-bind-show",function(){$(this).parents("tr").next().toggle();return $(this).parents("tr").toggleClass("bb_none")}).on("click",".fn-up",function(){if($(this).find("em").hasClass("up")){$(this).find("em").removeClass("up");return $(this).find(".low_pop").hide()}else{$(this).find("em").addClass("up");return $(this).find(".low_pop").show()}}).on("blur",".fn-up",function(){if($(this).find("em").hasClass("up")){$(this).find("em").removeClass("up");return $(this).find(".low_pop").hide()}}).on("click",".fn-similar",function(){pids=$(this).data("item");if($(this).find("em").hasClass("up")){$(this).find("em").removeClass("up");$(this).find("em").addClass("down");$("#tr_similar_"+pids).hide()}else{$(this).find("em").removeClass("down");$(this).find("em").addClass("up");$.ajax({type:"GET",url:"similar_view",cache:false,data:{pids:pids},dataType:"json",success:function(t){if(t.code!==0){return false}$("#tr_similar_"+pids).show();if(t.body==null||t.body.items==null||t.body.items.length<=0){$("#tr_similar_"+pids).find(".shopping_ads").html('<div class="ads_box"><a href="javascript:;" class="close fn-close-similar">关闭</a><div class="none_box"><img src="images/empty2.png">没有更多推荐商品~</div></div>');return false}return new a({uid:"0",title:"",id:"similar_"+pids,request_id:(ref5=t.body)!=null?ref5.requestId:void 0,length:t.body.items.length,provider:function(v){var u;u=(function(){var w,y,A,x,z;A=t.body.items.slice(0,(t.body.items.length>20?20:t.body.items.length)||[]);x=[];for(y=0,w=A.length;y<w;y++){product=A[y];if(product.isSPU==1||product.isMain==true){z=false}else{z=true}x.push({name:product.productName,price:{salePrice:product.salePrice/100},pid:product.productId,review_cnt:product.reviewCnt,addToCart:z,isMonitor:true,request_id:product.requestId,imgVersion:product.imgVersion})}return x})();return v.render(u)}})}})}});n.on("click",".fn-close-ss",function(){p.hide();n.hide().data("info",void 0);return false}).on("click",".fn-semasubmit",function(){var w,u,t,v;w=n.find(".fn-color.chosen:not(.disabled)");u=n.find(".fn-size.chosen:not(.disabled)");if(w.size()===0||u.size()===0){return false}else{if($(this).hasClass("fn-gift")){t={target:$(this).attr("target"),giftId:n.attr("newProductId"),cartItemId:$(this).attr("cartItemId"),promotionId:$(this).attr("promotionId"),from:$(this).attr("from")};l.changeGift(t)}else{$.ajax({type:"GET",url:"changeSku",cache:false,data:{newProductId:n.attr("newProductId"),cartItemId:n.attr("itemId")},dataType:"json",success:function(x){if(x&&x.code===-3){return false}var y;if(x.code===0){p.hide();n.hide().data("info",void 0);return l.show()}else{if(x.code===1){p.hide();return n.hide().data("info",void 0)}else{y=$(".fn-errormsg",n).text();if(y.indexOf("、该商品缺货！")===-1){return $(".fn-errormsg",n).text(y+"、该商品缺货！")}}}},error:function(x){p.hide();return n.hide().data("info",void 0)}})}}return false}).on("click",".fn-color",function(){var t,D,A,y,C,u,w,v,B,E,z,x;A=$(this);u=n.data("info");A.addClass("chosen").siblings().removeClass("chosen");if(A.hasClass("disabled")){$(".fn-semasubmit").addClass("sorry_i_dont")}else{$(".fn-semasubmit").removeClass("sorry_i_dont")}D=n.find(".fn-size").addClass("disabled");C=A.data("index");E=u.matrix_x[C];for(y=w=0,v=E.length;0<=v?w<v:w>v;y=0<=v?++w:--w){z=E[y];if(z&&z.stock!==0){D.filter(function(){if($(this).data("index")===y){return true}}).removeClass("disabled")}}t=D.filter(".chosen");B;x=E[t.data("index")];if((x!=null?x.stock:void 0)===0){if(x!=null?x.size:void 0){if(x.color){B=x.color+"、"+x.size+" 缺货，请您重新选择"}else{B=x.size+" 缺货，请您重新选择"}}else{B=x.color+" 缺货，请您重新选择"}$(".fn-semasubmit").addClass("sorry_i_dont")}else{if(x){$(".fn-semasubmit").removeClass("sorry_i_dont");n.attr("newProductId",x.productId);if(x.imageNum&&parseInt(x.imageNum)>0){n.find(".fn-img").attr("src",x.colorImage)}else{n.find(".fn-img").attr("src",l.getProductImgUrlWithVersion(x.mainProductId,x.productId,x.imageNum,n.attr("mainImgVersion"),"b"))}if(x!=null?x.size:void 0){if(x.color){B=x.color+"、"+x.size}else{B=x.size}}else{B=x.color}}else{$(".fn-semasubmit").addClass("sorry_i_dont")}}$(".fn-errormsg",n).text(B);return false}).on("click",".fn-size",function(){var A,t,C,u,z,E,w,x,v,D,B,y;C=$(this);w=n.data("info");C.addClass("chosen").siblings().removeClass("chosen");if(C.hasClass("disabled")){$(".fn-semasubmit").addClass("sorry_i_dont")}else{$(".fn-semasubmit").removeClass("sorry_i_dont")}A=n.find(".fn-color").addClass("disabled");E=C.data("index");u=w.matrix_y[E];for(z=x=0,v=u.length;0<=v?x<v:x>v;z=0<=v?++x:--x){B=u[z];if(B&&B.stock!==0){A.filter(function(){if($(this).data("index")===z){return true}}).removeClass("disabled")}}t=A.filter(".chosen");y=u[t.data("index")];D;if((y!=null?y.stock:void 0)===0){if(y!=null?y.color:void 0){if(y.size){D=y.color+"、"+y.size+" 缺货，请您重新选择"}else{D=y.color+" 缺货，请您重新选择"}}else{D=y.size+" 缺货，请您重新选择"}$(".fn-semasubmit").addClass("sorry_i_dont")}else{if(y){$(".fn-semasubmit").removeClass("sorry_i_dont");n.attr("newProductId",y.productId);if(y.imageNum&&parseInt(y.imageNum)>0){n.find(".fn-img").attr("src",y.colorImage)}else{n.find(".fn-img").attr("src",l.getProductImgUrlWithVersion(y.mainProductId,y.productId,y.imageNum,n.attr("mainImgVersion"),"b"))}if(y!=null?y.color:void 0){D=y.color+"、"+y.size}else{D=y.size}}else{$(".fn-semasubmit").addClass("sorry_i_dont")}}$(".fn-errormsg",n).text(D);return false});$("#giftArea").on("click",".fn-gift-left",function(){if($(this).hasClass("disable")){return}return $(this).parent().find("ul").each(function(t){if(!$(this).is(":hidden")){$(this).hide();if(t>0){$(this).prev().show();$(this).parent().find("a:eq(1)").removeClass("disable")}if(t>1){$(this).parent().find("a:first").removeClass("disable")}else{$(this).parent().find("a:first").addClass("disable")}return false}})}).on("click",".fn-gift-right",function(){var t;if($(this).hasClass("disable")){return}t=$(this).parent().find("ul").length;return $(this).parent().find("ul").each(function(u){if(!$(this).is(":hidden")){$(this).hide();if(u<t-1){$(this).next().show();$(this).parent().find("a:first").removeClass("disable")}if(u<t-2){$(this).parent().find("a:eq(1)").removeClass("disable")}else{$(this).parent().find("a:eq(1)").addClass("disable")}return false}})}).on("click",".fn-change-gift",function(){var u,t,v;if($(this).parent().find(".un_tip").length>0){return}t=$(this).parent().attr("id").split("_");u={giftId:t[1],cartItemId:t[0],promtionId:t[2]};v=$(this).parent();return l.addGift(u,v)});$("#giftDiv").on("click",".fn-back-cart",function(){$("#giftDiv").hide();return l.show()}).on("click",".close",function(){$("#giftDiv").hide();return l.show()});$("#spuPromoLimitDiv").on("click",".btn_red",function(){return $("#spuPromoLimitDiv").hide()}).on("click",".pop_btn",function(){return $("#spuPromoLimitDiv").hide()}).on("click",".close",function(){return $("#spuPromoLimitDiv").hide()});$("#stockShortDiv").on("click",".btn_red",function(){var A=$("#stockShortDiv .out_list").children();var u="";var y="";var w="";for(var v=0;v<A.length;v++){var z={};var t=$(A[v]);z.itemId=t.data("item-id");z.giftId=t.data("gift-id");z.count=t.data("count");z.stock=t.data("stock");z.batchId=t.data("batch-id");if(z.giftId){w+=(z.giftId+",")}else{if(!z.batchId){u+=(z.itemId+"."+z.stock+",")}else{y+=(z.batchId+"."+z.stock+",")}}}var x=function(B){if(B){$.ajax({type:"GET",url:"removeGiftBatch",cache:false,data:{itemGiftId:B},dataType:"json",success:function(C){$("#stockShortDiv").hide();l.show()},error:function(){$("#stockShortDiv").hide();var C=$("#J_errorBox");C.find("p").html("请求处理失败");l.showTip("",C,"")}})}else{$("#stockShortDiv").hide();l.show()}};if(u||y){$.ajax({type:"GET",url:"update_count_batch",cache:false,data:{itemIdAndCounts:u,batchIdAndCounts:y},dataType:"json",success:function(B){x(w)},error:function(){$("#stockShortDiv").hide();var B=$("#J_errorBox");B.find("p").html("请求处理失败");l.showTip("",B,"")}})}else{x(w)}}).on("click",".close",function(){$("#stockShortDiv").hide()});$("#pointFavorErrorPageForCheckOut").on("click",".cancel",function(){$("#usePointFavorProductInfoList").html("");return $("#pointFavorErrorPageForCheckOut").hide()}).on("click",".close",function(){$("#usePointFavorProductInfoList").html("");return $("#pointFavorErrorPageForCheckOut").hide()}).on("click",".change_num>span",function(){var t;if($(this).text()==="+"){t=true}else{if($(this).text()==="-"){t=false}else{return false}}var u=parseInt($(this).parent().find(".countInput").val());var v=t==true?(u+1):(u-1);l.checkPointFavorDialog($(this),parseInt(v),parseInt($(this).parent().find(".countInput").data("current")))}).on("keypress",".change_num>input",function(v){var t,u,w;w=$(this).val();t=/^\d+$/;u=v.keyCode||v.which;if(u===13){if(!t.test(w)){$(this).val(1)}if(parseInt($(this).val())!=parseInt($(this).data("current"))){l.checkPointFavorDialog($(this),parseInt($(this).val()),parseInt($(this).data("current")))}}else{if(u===8){}else{if(b.call([48,49,50,51,52,53,54,55,56,57],u)<0){return false}}}}).on("blur",".change_num>input",function(v){var t,x,u,w;w=$(this).val();u=/^\d+$/;if(!u.test(w)){$(this).val(1)}if(parseInt($(this).val())!=parseInt($(this).data("current"))){l.checkPointFavorDialog($(this),parseInt($(this).val()),parseInt($(this).data("current")))}}).on("click",".confirm",function(u){var t=parseInt($("#allNeedPointNum").html());var w=parseInt($("#userHasPointNum").html());if(t>w){$("#pointFavorErrorPageForCheckOut").find(".remind_info").hide();$("#pointFavorErrorPageForCheckOut").find(".remind_info").show("slow");return false}var v="";$(this).parent().parent().find(".item").each(function(){var y=$(this).data("itemid");var x=$(this).find(".countInput").val();if(y!=null&&y!=""&&x!=null&&x!=""){v+=y+"."+x+","}});if(v!=""){v=v.substring(0,v.length-1);$.ajax({type:"GET",url:"update_count_batch_for_point_favor",cache:false,data:{itemIdAndCounts:v,},dataType:"json",success:function(x){$("#usePointFavorProductInfoList").html("");$("#pointFavorErrorPageForCheckOut").hide();l.show()},error:function(){$("#usePointFavorProductInfoList").html("");$("#pointFavorErrorPageForCheckOut").hide();var x=$("#J_errorBox");x.find("p").html("请求处理失败");l.showTip("",x,"")}})}});k=function(u){var t;if(u==null){u={}}t=function(F){var C,v,G,z,A,x,y,B,E,w,D,H;x={};x.map={title:u.name,colorname:F.colorName,sizename:F.sizeName,img:F.imageNum===0?l.getProductImgUrlWithVersion(u.mainProductId||0,u.pid,u.numImages||0,F.imgVersion||0,"b"):F.currenProdImgUrl};x.matrix_x=[];x.matrix_y=[];x.colors=[];x.sizes=[];D;w=F.packages;for(y=0,B=w.length;y<B;y++){E=w[y];if(!x.colors[E.colorIndex]||x.colors[E.colorIndex].selected===false){x.colors[E.colorIndex]={color:E.color,img:E.colorImage,index:E.colorIndex,selected:false};if(u.pid===E.productId){x.colors[E.colorIndex].selected=true;D=E.color}}if(!x.sizes[E.sizeIndex]||x.sizes[E.sizeIndex].selected===false){x.sizes[E.sizeIndex]={size:E.size,index:E.sizeIndex,selected:false};if(u.pid===E.productId){if(D){D+="、"+E.size}else{D=E.size}x.sizes[E.sizeIndex].selected=true}}if(!x.matrix_x[E.colorIndex]){x.matrix_x[E.colorIndex]=[]}if(!x.matrix_x[E.colorIndex][E.sizeIndex]){x.matrix_x[E.colorIndex][E.sizeIndex]=[]}x.matrix_x[E.colorIndex][E.sizeIndex]=E;if(!x.matrix_y[E.sizeIndex]){x.matrix_y[E.sizeIndex]=[]}if(!x.matrix_y[E.sizeIndex][E.colorIndex]){x.matrix_y[E.sizeIndex][E.colorIndex]=[]}x.matrix_y[E.sizeIndex][E.colorIndex]=E;console.log(x.matrix_x,x.matrix_y)}$(".fn-errormsg",n).text(D);C=(function(){var K,I,J,L;J=x.colors;L=[];for(I=0,K=J.length;I<K;I++){A=J[I];if(A){if(A.selected){if(A.color){L.push($("<li class='fn-color chosen' data-index='"+A.index+"'><a href='javascript:;' title='"+A.color+"'><img src='"+A.img+"' alt='"+x.map.colorname+"'></a></li>"))}else{L.push($("<li class='fn-color chosen' data-index='"+A.index+"'></li>"))}}else{if(A.color){L.push($("<li class='fn-color' data-index='"+A.index+"'><a href='javascript:;' title='"+A.color+"'><img src='"+A.img+"' alt='"+x.map.colorname+"'></a></li>"))}else{L.push($("<li class='fn-color chosen' data-index='"+A.index+"'></li>"))}}}else{L.push("")}}return L})();G=(function(){var K,I,J,L;J=x.sizes;L=[];for(I=0,K=J.length;I<K;I++){H=J[I];if(H){if(H.selected){if(H.size){L.push($("<li class='fn-size chosen'  data-index='"+H.index+"'><a  href='javascript:;'>"+H.size+"</a></li>"))}else{L.push($("<li class='fn-size chosen'  data-index='"+H.index+"'></li>"))}}else{if(H.size){L.push($("<li class='fn-size'  data-index='"+H.index+"'><a  href='javascript:;'>"+H.size+"</a></li>"))}else{L.push($("<li class='fn-size chosen'  data-index='"+H.index+"'></li>"))}}}else{L.push("")}}return L})();n.detach();n.find(".fn-img").attr("src",x.map.img).end().find(".fn-colors").html(C).end().find(".fn-sizes").html(G).end().find(".fn-data").each(function(){var I;I=$(this).data("set");return $(this).html(x.map[I]||"")}).end().data("info",x);p.after(n).show();z=n.find(".fn-color");allSize=n.find(".fn-size");if((z!=null?z.length:void 0)>0&&z.filter(".chosen").length>0){v=z.filter(".chosen");v.trigger("click")}else{if((allSize!=null?allSize.length:void 0)>0&&allSize.filter(".chosen").length>0){$selectedSize=allSize.filter(".chosen");$selectedSize.trigger("click")}else{$(".fn-semasubmit").addClass("sorry_i_dont")}}if(u.isGift){$(".fn-semasubmit").addClass("fn-gift");$(".fn-semasubmit").attr("target",u.target);$(".fn-semasubmit").attr("cartItemId",u.cartItemId);$(".fn-semasubmit").attr("promotionId",u.promotionId);$(".fn-semasubmit").attr("from",u.from)}else{$(".fn-semasubmit").removeClass("fn-gift");$(".fn-semasubmit").removeAttr("target");$(".fn-semasubmit").removeAttr("cartItemId");$(".fn-semasubmit").removeAttr("promotionId");$(".fn-semasubmit").removeAttr("from")}return x};return $.ajax({type:"GET",url:"getSkuInfo",cache:false,data:{productId:u.pid||0},dataType:"json",success:function(w){var v;v=w.body;if(w.code===0){n.attr("itemId",u.itemId);n.attr("mainImgVersion",v.imgVersion||0);t(v);return n.show()}}})};l=new c();window.cart=l;window.utils=d;l.show({initPage:true})})}).call(this);var spuErrorInfoRecord=function(b,d,e,a,f,c){this.productId=b;this.productName=d;this.mainId=e;this.buyNum=a;this.cartItemId=f;this.maxBuyNum=c};$.ajaxSetup({complete:function(c,e){var d=c.responseText;if(d&&d.indexOf("flowLimitError.")>0){try{var a=JSON.parse(d);if(a&&a.code===-3&&a.body==="flowLimitError."){alert("当前请求被限制，请稍后重试！");window.location.href="errorPage";return}}catch(b){}}}});